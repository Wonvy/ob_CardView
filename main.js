/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __markAsModule = (target) => __defProp(target, "__esModule", { value: true });
var __export = (target, all) => {
  __markAsModule(target);
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __reExport = (target, module2, desc) => {
  if (module2 && typeof module2 === "object" || typeof module2 === "function") {
    for (let key of __getOwnPropNames(module2))
      if (!__hasOwnProp.call(target, key) && key !== "default")
        __defProp(target, key, { get: () => module2[key], enumerable: !(desc = __getOwnPropDesc(module2, key)) || desc.enumerable });
  }
  return target;
};
var __toModule = (module2) => {
  return __reExport(__markAsModule(__defProp(module2 != null ? __create(__getProtoOf(module2)) : {}, "default", module2 && module2.__esModule && "default" in module2 ? { get: () => module2.default, enumerable: true } : { value: module2, enumerable: true })), module2);
};

// main.ts
__export(exports, {
  default: () => CardViewPlugin
});
var import_obsidian2 = __toModule(require("obsidian"));

// cardView.ts
var import_obsidian = __toModule(require("obsidian"));
var VIEW_TYPE_CARD = "card-view";
var CardView = class extends import_obsidian.ItemView {
  constructor(leaf, plugin) {
    super(leaf);
    this.isPreviewCollapsed = false;
    this.currentFolder = null;
    this.currentSearchTerm = "";
    this.selectedTags = new Set();
    this.selectedNotes = new Set();
    this.lastSelectedNote = null;
    this.recentFolders = [];
    this.cardSize = 280;
    this.MIN_CARD_SIZE = 280;
    this.MAX_CARD_SIZE = 600;
    this.plugin = plugin;
    this.currentView = plugin.settings.defaultView;
  }
  getViewType() {
    return VIEW_TYPE_CARD;
  }
  getDisplayText() {
    return "\u5361\u7247\u89C6\u56FE";
  }
  async onOpen() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.addClass("card-view-container");
    const toolbar = containerEl.createDiv("card-view-toolbar");
    const leftTools = toolbar.createDiv("toolbar-left");
    const newNoteBtn = leftTools.createEl("button", {
      cls: "new-note-button"
    });
    newNoteBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            <span>\u65B0\u5EFA\u7B14\u8BB0</span>
        `;
    newNoteBtn.addEventListener("click", () => this.createNewNote());
    const viewSwitcher = leftTools.createDiv("view-switcher");
    this.createViewSwitcher(viewSwitcher);
    const searchContainer = toolbar.createDiv("search-container");
    this.searchInput = searchContainer.createEl("input", {
      type: "text",
      placeholder: "\u641C\u7D22\u7B14\u8BB0...",
      cls: "search-input"
    });
    this.searchInput.addEventListener("input", () => {
      this.currentSearchTerm = this.searchInput.value;
      this.refreshView();
    });
    this.tagContainer = containerEl.createDiv("tag-filter");
    await this.loadTags();
    const contentArea = containerEl.createDiv("card-view-content");
    this.container = contentArea.createDiv("card-container");
    const previewWrapper = containerEl.createDiv("preview-wrapper");
    this.previewContainer = previewWrapper.createDiv("preview-container");
    const previewControls = previewWrapper.createDiv("preview-controls");
    const toggleButton = previewControls.createEl("button", {
      cls: "preview-toggle",
      attr: { "aria-label": "\u6298\u53E0\u9884\u89C8" }
    });
    toggleButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg>`;
    toggleButton.addEventListener("click", () => this.togglePreview());
    this.previewResizer = previewWrapper.createDiv("preview-resizer");
    this.setupResizer();
    document.addEventListener("wheel", (e) => {
      if (e.ctrlKey) {
        e.preventDefault();
        this.adjustCardSize(e.deltaY);
      }
    }, { passive: false });
    await this.loadNotes();
  }
  async loadTags() {
    const tags = this.getAllTags();
    const allTagBtn = this.tagContainer.createEl("button", {
      text: "All",
      cls: "tag-btn active"
    });
    allTagBtn.addEventListener("click", () => {
      this.clearTagSelection();
      allTagBtn.addClass("active");
      this.refreshView();
    });
    tags.forEach((tag) => {
      const tagBtn = this.tagContainer.createEl("button", {
        text: tag,
        cls: "tag-btn"
      });
      tagBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        this.toggleTag(tag, tagBtn);
      });
    });
  }
  getAllTags() {
    const tags = new Set();
    this.app.vault.getMarkdownFiles().forEach((file) => {
      const cache = this.app.metadataCache.getFileCache(file);
      if (cache == null ? void 0 : cache.tags) {
        cache.tags.forEach((tag) => tags.add(tag.tag));
      }
    });
    return Array.from(tags);
  }
  createViewSwitcher(container) {
    const views = [
      { id: "card", icon: "grid", text: "\u5361\u7247\u89C6\u56FE" },
      { id: "list", icon: "list", text: "\u5217\u8868\u89C6\u56FE" },
      { id: "timeline", icon: "clock", text: "\u65F6\u95F4\u8F74\u89C6\u56FE" }
    ];
    views.forEach((view) => {
      const btn = container.createEl("button", {
        cls: `view-switch-btn ${view.id === this.currentView ? "active" : ""}`
      });
      const iconHtml = {
        "grid": '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>',
        "list": '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>',
        "clock": '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>'
      };
      const iconSpan = btn.createSpan({ cls: "view-switch-icon" });
      iconSpan.innerHTML = iconHtml[view.icon];
      btn.createSpan({ text: view.text, cls: "view-switch-text" });
      btn.addEventListener("click", () => {
        container.querySelectorAll(".view-switch-btn").forEach((b) => b.removeClass("active"));
        btn.addClass("active");
        this.switchView(view.id);
      });
    });
  }
  async loadNotes() {
    const files = this.app.vault.getMarkdownFiles();
    this.container.empty();
    const cards = await Promise.all(files.map((file) => this.createNoteCard(file)));
    cards.forEach((card) => {
      this.container.appendChild(card);
    });
  }
  async createNoteCard(file) {
    const card = document.createElement("div");
    card.addClass("note-card");
    card.setAttribute("data-path", file.path);
    const header = card.createDiv("note-card-header");
    const lastModified = header.createDiv("note-date");
    lastModified.setText(new Date(file.stat.mtime).toLocaleDateString());
    const folderPath = header.createDiv("note-folder");
    const folder = file.parent ? file.parent.path === "/" ? "\u6839\u76EE\u5F55" : file.parent.path : "\u6839\u76EE\u5F55";
    folderPath.setText(folder);
    folderPath.setAttribute("title", `\u6253\u5F00\u6587\u4EF6\u5939: ${folder}`);
    folderPath.addEventListener("click", async (e) => {
      e.stopPropagation();
      const fileExplorer = this.app.workspace.getLeavesOfType("file-explorer")[0];
      if (fileExplorer) {
        const fileExplorerView = fileExplorer.view;
        if (fileExplorerView.expandFolder) {
          await this.revealFolderInExplorer(folder);
          fileExplorer.setEphemeralState({ focus: true });
        }
      }
    });
    const openButton = header.createDiv("note-open-button");
    openButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>`;
    openButton.setAttribute("title", "\u5728\u65B0\u6807\u7B7E\u9875\u4E2D\u6253\u5F00");
    openButton.style.opacity = "0";
    const cardContent = card.createDiv("note-card-content");
    const title = cardContent.createDiv("note-title");
    let displayTitle = file.basename;
    const timePattern = /^\d{4}[-./]\d{2}[-./]\d{2}/;
    if (timePattern.test(displayTitle)) {
      displayTitle = displayTitle.replace(timePattern, "").trim();
    }
    title.setText(displayTitle);
    try {
      const content = await this.app.vault.read(file);
      const noteContent = cardContent.createDiv("note-content");
      await import_obsidian.MarkdownRenderer.renderMarkdown(content, noteContent, file.path, this);
      card.addEventListener("mouseenter", async () => {
        openButton.style.opacity = "1";
        title.style.opacity = "0";
        noteContent.style.display = "block";
        try {
          this.previewContainer.empty();
          await import_obsidian.MarkdownRenderer.renderMarkdown(content, this.previewContainer, file.path, this);
        } catch (error) {
          console.error("\u9884\u89C8\u52A0\u8F7D\u5931\u8D25:", error);
        }
      });
      card.addEventListener("mouseleave", () => {
        openButton.style.opacity = "0";
        title.style.opacity = "1";
        noteContent.style.display = "none";
      });
      openButton.addEventListener("click", async (e) => {
        e.stopPropagation();
        const leaf = this.app.workspace.getLeaf("tab");
        await leaf.openFile(file);
      });
      card.addEventListener("click", (e) => {
        this.handleCardSelection(file.path, e);
      });
      card.addEventListener("dblclick", async () => {
        const leaf = this.app.workspace.getLeaf("tab");
        await leaf.openFile(file);
      });
      card.addEventListener("contextmenu", (e) => {
        e.preventDefault();
        this.showContextMenu(e, this.getSelectedFiles());
      });
    } catch (error) {
      console.error("\u7B14\u8BB0\u52A0\u8F7D\u5931\u8D25:", error);
    }
    card.addEventListener("mouseenter", async () => {
      openButton.style.opacity = "1";
    });
    card.addEventListener("mouseleave", () => {
      openButton.style.opacity = "0";
    });
    return card;
  }
  switchView(view) {
    this.currentView = view;
    this.container.setAttribute("data-view", view);
    this.container.empty();
    if (view === "timeline") {
      this.createTimelineView();
    } else {
      this.loadNotes();
    }
  }
  async filterByTag(tag) {
    const files = this.app.vault.getMarkdownFiles();
    this.container.empty();
    const filteredFiles = files.filter((file) => {
      var _a;
      const cache = this.app.metadataCache.getFileCache(file);
      return (_a = cache == null ? void 0 : cache.tags) == null ? void 0 : _a.some((t) => t.tag === tag);
    });
    const cards = await Promise.all(filteredFiles.map((file) => this.createNoteCard(file)));
    cards.forEach((card) => {
      this.container.appendChild(card);
    });
    this.tagContainer.querySelectorAll("button").forEach((btn) => {
      if (btn.textContent === tag) {
        btn.addClass("active-tag");
      } else {
        btn.removeClass("active-tag");
      }
    });
  }
  togglePreview() {
    this.isPreviewCollapsed = !this.isPreviewCollapsed;
    if (this.isPreviewCollapsed) {
      this.previewContainer.addClass("collapsed");
    } else {
      this.previewContainer.removeClass("collapsed");
    }
  }
  setupResizer() {
    let startX;
    let startWidth;
    const startResize = (e) => {
      e.preventDefault();
      startX = e.pageX;
      startWidth = parseInt(getComputedStyle(this.previewContainer).width, 10);
      document.addEventListener("mousemove", resize);
      document.addEventListener("mouseup", stopResize);
      document.body.style.cursor = "col-resize";
      this.previewResizer.addClass("resizing");
    };
    const resize = (e) => {
      const width = startWidth - (e.pageX - startX);
      if (width >= 50 && width <= 800) {
        this.previewContainer.style.width = `${width}px`;
        if (this.isPreviewCollapsed) {
          this.isPreviewCollapsed = false;
          this.previewContainer.removeClass("collapsed");
        }
      }
    };
    const stopResize = () => {
      document.removeEventListener("mousemove", resize);
      document.removeEventListener("mouseup", stopResize);
      document.body.style.cursor = "";
      this.previewResizer.removeClass("resizing");
    };
    this.previewResizer.addEventListener("mousedown", startResize);
  }
  highlightFolder(folder) {
    this.currentFolder = this.currentFolder === folder ? null : folder;
    this.container.querySelectorAll(".note-card").forEach((card) => {
      const folderElement = card.querySelector(".note-folder");
      const cardFolder = folderElement ? folderElement.textContent : null;
      if (cardFolder) {
        card.toggleClass("folder-highlight", cardFolder === folder);
      }
    });
  }
  async revealFolderInExplorer(folder) {
    const fileExplorer = this.app.workspace.getLeavesOfType("file-explorer")[0];
    if (fileExplorer) {
      const fileExplorerView = fileExplorer.view;
      if (folder === "\u6839\u76EE\u5F55") {
        if (fileExplorerView.expandFolder) {
          await fileExplorerView.expandFolder("/");
        }
        return;
      }
      if (fileExplorerView.expandFolder) {
        const folderParts = folder.split("/");
        let currentPath = "";
        for (const part of folderParts) {
          currentPath += (currentPath ? "/" : "") + part;
          await fileExplorerView.expandFolder(currentPath);
        }
        if (fileExplorerView.setSelection) {
          await fileExplorerView.setSelection(folder);
        }
      }
    }
  }
  async createNewNote() {
    const date = new Date();
    const fileName = `\u672A\u547D\u540D\u7B14\u8BB0 ${date.toLocaleString().replace(/[/:]/g, "-")}`;
    try {
      const file = await this.app.vault.create(`${fileName}.md`, "# " + fileName + "\n\n");
      const leaf = this.app.workspace.getLeaf("tab");
      await leaf.openFile(file);
      this.loadNotes();
    } catch (error) {
      console.error("\u521B\u5EFA\u7B14\u8BB0\u5931\u8D25:", error);
    }
  }
  async createTimelineView() {
    const timelineContainer = this.container.createDiv("timeline-container");
    const files = this.app.vault.getMarkdownFiles();
    const notesByDate = new Map();
    files.forEach((file) => {
      const date = new Date(file.stat.mtime).toLocaleDateString();
      if (!notesByDate.has(date)) {
        notesByDate.set(date, []);
      }
      const notes = notesByDate.get(date);
      if (notes) {
        notes.push(file);
      }
    });
    const sortedDates = Array.from(notesByDate.keys()).sort((a, b) => new Date(b).getTime() - new Date(a).getTime());
    for (const date of sortedDates) {
      const dateGroup = timelineContainer.createDiv("timeline-date-group");
      const dateNode = dateGroup.createDiv("timeline-date-node");
      dateNode.createDiv("timeline-node-circle");
      dateNode.createDiv("timeline-date-label").setText(date);
      const notesList = dateGroup.createDiv("timeline-notes-list");
      const notes = notesByDate.get(date);
      if (notes) {
        for (const file of notes) {
          const noteItem = notesList.createDiv("timeline-note-item");
          noteItem.createDiv("timeline-note-marker");
          const noteContent = noteItem.createDiv("timeline-note-content");
          noteContent.createDiv("timeline-note-title").setText(file.basename);
          noteItem.addEventListener("click", async () => {
            const leaf = this.app.workspace.getLeaf("tab");
            await leaf.openFile(file);
          });
          noteItem.addEventListener("mouseenter", async () => {
            try {
              this.previewContainer.empty();
              const content = await this.app.vault.read(file);
              await import_obsidian.MarkdownRenderer.renderMarkdown(content, this.previewContainer, file.path, this);
            } catch (error) {
              console.error("\u9884\u89C8\u52A0\u8F7D\u5931\u8D25:", error);
            }
          });
        }
      }
    }
  }
  addContextMenu(card, file) {
    card.addEventListener("contextmenu", (event) => {
      event.preventDefault();
      event.stopPropagation();
      const path = card.getAttribute("data-path");
      if (path && !this.selectedNotes.has(path) && !event.ctrlKey) {
        this.clearSelection();
        this.selectedNotes.add(path);
        card.addClass("selected");
      }
      const selectedFiles = this.getSelectedFiles();
      this.showContextMenu(event, selectedFiles);
    });
  }
  async refreshView() {
    const files = this.app.vault.getMarkdownFiles();
    this.container.empty();
    const filteredFiles = files.filter((file) => {
      var _a, _b;
      const matchesSearch = !this.currentSearchTerm || file.basename.toLowerCase().includes(this.currentSearchTerm.toLowerCase());
      let matchesTags = true;
      if (this.selectedTags.size > 0) {
        const cache = this.app.metadataCache.getFileCache(file);
        matchesTags = (_b = (_a = cache == null ? void 0 : cache.tags) == null ? void 0 : _a.some((t) => this.selectedTags.has(t.tag))) != null ? _b : false;
      }
      return matchesSearch && matchesTags;
    });
    const cards = await Promise.all(filteredFiles.map((file) => this.createNoteCard(file)));
    cards.forEach((card) => {
      this.container.appendChild(card);
    });
  }
  toggleTag(tag, tagBtn) {
    if (this.selectedTags.has(tag)) {
      this.selectedTags.delete(tag);
      tagBtn.removeClass("active");
    } else {
      this.selectedTags.add(tag);
      tagBtn.addClass("active");
    }
    const allBtn = this.tagContainer.querySelector("button");
    if (allBtn) {
      allBtn.removeClass("active");
    }
    this.refreshView();
  }
  clearTagSelection() {
    this.selectedTags.clear();
    this.tagContainer.querySelectorAll(".tag-btn").forEach((btn) => {
      btn.removeClass("active");
    });
  }
  handleCardSelection(path, event) {
    const card = this.container.querySelector(`[data-path="${path}"]`);
    if (!card)
      return;
    if (event.ctrlKey) {
      if (this.selectedNotes.has(path)) {
        this.selectedNotes.delete(path);
        card.removeClass("selected");
      } else {
        this.selectedNotes.add(path);
        card.addClass("selected");
      }
    } else if (event.shiftKey && this.lastSelectedNote) {
      const cards = Array.from(this.container.querySelectorAll(".note-card"));
      const lastIndex = cards.findIndex((c) => c.getAttribute("data-path") === this.lastSelectedNote);
      const currentIndex = cards.findIndex((c) => c.getAttribute("data-path") === path);
      const start = Math.min(lastIndex, currentIndex);
      const end = Math.max(lastIndex, currentIndex);
      cards.forEach((c, i) => {
        const cardPath = c.getAttribute("data-path");
        if (i >= start && i <= end && cardPath) {
          this.selectedNotes.add(cardPath);
          c.addClass("selected");
        }
      });
    } else {
      this.clearSelection();
      this.selectedNotes.add(path);
      card.addClass("selected");
    }
    this.lastSelectedNote = path;
  }
  clearSelection() {
    this.selectedNotes.clear();
    this.container.querySelectorAll(".note-card.selected").forEach((card) => {
      card.removeClass("selected");
    });
  }
  getSelectedFiles() {
    return Array.from(this.selectedNotes).map((path) => this.app.vault.getAbstractFileByPath(path)).filter((file) => file instanceof import_obsidian.TFile);
  }
  showContextMenu(event, files) {
    const menu = new import_obsidian.Menu();
    if (files.length > 0) {
      menu.addItem((item) => {
        item.setTitle(`\u5728\u65B0\u6807\u7B7E\u9875\u6253\u5F00`).setIcon("link").onClick(async () => {
          for (const file of files) {
            const leaf = this.app.workspace.getLeaf("tab");
            await leaf.openFile(file);
          }
        });
      });
      menu.addItem((item) => {
        item.setTitle(`\u5728\u6587\u4EF6\u7BA1\u7406\u5668\u4E2D\u663E\u793A`).setIcon("folder").onClick(() => {
          var _a;
          const file = files[0];
          this.revealFolderInExplorer(((_a = file.parent) == null ? void 0 : _a.path) || "/");
        });
      });
      menu.addItem((item) => {
        item.setTitle(`\u79FB\u52A8 ${files.length} \u4E2A\u6587\u4EF6`).setIcon("move").onClick(() => {
          const modal = new EnhancedFileSelectionModal(this.app, files, this.recentFolders, (folders) => {
            this.recentFolders = folders;
          });
          modal.open();
        });
      });
      menu.addItem((item) => {
        item.setTitle(`\u5220\u9664 ${files.length} \u4E2A\u6587\u4EF6`).setIcon("trash").onClick(async () => {
          const confirm = await new ConfirmModal(this.app, "\u786E\u8BA4\u5220\u9664", `\u662F\u5426\u786E\u5B9A\u8981\u5220\u9664\u9009\u4E2D\u7684 ${files.length} \u4E2A\u6587\u4EF6\uFF1F`).show();
          if (confirm) {
            for (const file of files) {
              await this.app.vault.trash(file, true);
            }
            this.refreshView();
          }
        });
      });
    }
    menu.showAtMouseEvent(event);
  }
  adjustCardSize(delta) {
    const adjustment = delta > 0 ? -10 : 10;
    const newSize = Math.max(this.MIN_CARD_SIZE, Math.min(this.MAX_CARD_SIZE, this.cardSize + adjustment));
    if (newSize !== this.cardSize) {
      this.cardSize = newSize;
      this.container.querySelectorAll(".note-card").forEach((card) => {
        card.style.width = `${this.cardSize}px`;
      });
      this.container.style.gridTemplateColumns = `repeat(auto-fill, ${this.cardSize}px)`;
    }
  }
};
var ConfirmModal = class extends import_obsidian.Modal {
  constructor(app, title, message) {
    super(app);
    this.result = false;
    this.title = title;
    this.message = message;
  }
  async show() {
    return new Promise((resolve) => {
      this.resolvePromise = resolve;
      this.open();
    });
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.createEl("h3", { text: this.title });
    contentEl.createEl("p", { text: this.message });
    const buttonContainer = contentEl.createDiv("button-container");
    const confirmButton = buttonContainer.createEl("button", { text: "\u786E\u8BA4" });
    confirmButton.addEventListener("click", () => {
      this.result = true;
      this.close();
    });
    const cancelButton = buttonContainer.createEl("button", { text: "\u53D6\u6D88" });
    cancelButton.addEventListener("click", () => {
      this.result = false;
      this.close();
    });
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
    this.resolvePromise(this.result);
  }
};
var EnhancedFileSelectionModal = class extends import_obsidian.Modal {
  constructor(app, files, recentFolders, onFoldersUpdate) {
    super(app);
    this.selectedFolder = null;
    this.files = files;
    this.recentFolders = recentFolders;
    this.onFoldersUpdate = onFoldersUpdate;
  }
  async onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.createEl("h3", {
      text: `\u79FB\u52A8 ${this.files.length} \u4E2A\u6587\u4EF6`
    });
    if (this.recentFolders.length > 0) {
      const recentSection = contentEl.createDiv("recent-folders-section");
      recentSection.createEl("h4", { text: "\u6700\u8FD1\u4F7F\u7528" });
      const recentList = recentSection.createDiv("recent-folders-list");
      this.recentFolders.forEach((folder) => {
        const item = recentList.createDiv("folder-item recent");
        item.setText(folder);
        item.addEventListener("click", () => this.selectFolder(item, folder));
      });
    }
    const folderList = contentEl.createDiv("folder-list");
    const folders = this.getFoldersWithHierarchy();
    this.createFolderTree(folderList, folders);
    const buttonContainer = contentEl.createDiv("modal-button-container");
    const confirmButton = buttonContainer.createEl("button", {
      text: "\u786E\u8BA4\u79FB\u52A8",
      cls: "mod-cta"
    });
    confirmButton.addEventListener("click", () => {
      if (this.selectedFolder) {
        this.moveFiles(this.selectedFolder);
      }
    });
    const cancelButton = buttonContainer.createEl("button", {
      text: "\u53D6\u6D88"
    });
    cancelButton.addEventListener("click", () => this.close());
  }
  getFoldersWithHierarchy() {
    const folders = [];
    const seen = new Set();
    this.app.vault.getAllLoadedFiles().forEach((file) => {
      if (file instanceof import_obsidian.TFolder) {
        const parts = file.path.split("/");
        let currentPath = "";
        let level = 0;
        parts.forEach((part) => {
          if (part) {
            currentPath += (currentPath ? "/" : "") + part;
            if (!seen.has(currentPath)) {
              seen.add(currentPath);
              folders.push({
                path: currentPath,
                name: part,
                level
              });
            }
            level++;
          }
        });
      }
    });
    return folders.sort((a, b) => a.path.localeCompare(b.path));
  }
  createFolderTree(container, folders) {
    folders.forEach((folder) => {
      const item = container.createDiv({
        cls: "folder-item"
      });
      item.style.paddingLeft = `${folder.level * 20 + 10}px`;
      const icon = item.createSpan({
        cls: "folder-icon"
      });
      icon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>`;
      const name = item.createSpan({
        cls: "folder-name",
        text: folder.name
      });
      item.addEventListener("click", () => this.selectFolder(item, folder.path));
    });
  }
  selectFolder(element, path) {
    this.contentEl.querySelectorAll(".folder-item").forEach((item) => {
      item.removeClass("selected");
    });
    element.addClass("selected");
    this.selectedFolder = path;
  }
  async moveFiles(targetFolder) {
    const confirmModal = new ConfirmModal(this.app, "\u786E\u8BA4\u79FB\u52A8", `\u662F\u5426\u5C06\u9009\u4E2D\u7684 ${this.files.length} \u4E2A\u6587\u4EF6\u79FB\u52A8\u5230 "${targetFolder}"\uFF1F`);
    if (await confirmModal.show()) {
      for (const file of this.files) {
        const newPath = `${targetFolder}/${file.name}`;
        await this.app.fileManager.renameFile(file, newPath);
      }
      this.recentFolders = [targetFolder, ...this.recentFolders.filter((f) => f !== targetFolder)].slice(0, 5);
      this.onFoldersUpdate(this.recentFolders);
      this.close();
    }
  }
};

// main.ts
var DEFAULT_SETTINGS = {
  defaultView: "card"
};
var CardViewSettingTab = class extends import_obsidian2.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian2.Setting(containerEl).setName("\u9ED8\u8BA4\u89C6\u56FE").setDesc("\u9009\u62E9\u9ED8\u8BA4\u7684\u89C6\u56FE\u6A21\u5F0F").addDropdown((dropdown) => {
      dropdown.addOption("card", "\u5361\u7247\u89C6\u56FE").addOption("list", "\u5217\u8868\u89C6\u56FE").addOption("timeline", "\u65F6\u95F4\u8F74\u89C6\u56FE").setValue(this.plugin.settings.defaultView);
      dropdown.onChange(async (value) => {
        if (value === "card" || value === "list" || value === "timeline") {
          this.plugin.settings.defaultView = value;
          await this.plugin.saveSettings();
        }
      });
      return dropdown;
    });
  }
};
var CardViewPlugin = class extends import_obsidian2.Plugin {
  async onload() {
    await this.loadSettings();
    this.registerView(VIEW_TYPE_CARD, (leaf) => new CardView(leaf, this));
    this.addRibbonIcon("layout-grid", "\u5361\u7247\u89C6\u56FE", () => {
      this.activateView();
    });
    this.addSettingTab(new CardViewSettingTab(this.app, this));
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  async activateView() {
    const { workspace } = this.app;
    let leaf = workspace.getLeavesOfType(VIEW_TYPE_CARD)[0];
    if (!leaf) {
      leaf = workspace.getLeaf("tab");
      await leaf.setViewState({
        type: VIEW_TYPE_CARD,
        active: true
      });
    }
    workspace.revealLeaf(leaf);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJjYXJkVmlldy50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBQbHVnaW4sIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcsIFRGaWxlLCBXb3Jrc3BhY2VMZWFmIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgeyBDYXJkVmlldywgVklFV19UWVBFX0NBUkQgfSBmcm9tICcuL2NhcmRWaWV3JztcclxuXHJcbmludGVyZmFjZSBDYXJkVmlld1BsdWdpblNldHRpbmdzIHtcclxuICAgIGRlZmF1bHRWaWV3OiAnY2FyZCcgfCAnbGlzdCcgfCAndGltZWxpbmUnO1xyXG59XHJcblxyXG5jb25zdCBERUZBVUxUX1NFVFRJTkdTOiBDYXJkVmlld1BsdWdpblNldHRpbmdzID0ge1xyXG4gICAgZGVmYXVsdFZpZXc6ICdjYXJkJ1xyXG59XHJcblxyXG5jbGFzcyBDYXJkVmlld1NldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcclxuICAgIHBsdWdpbjogQ2FyZFZpZXdQbHVnaW47XHJcblxyXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogQ2FyZFZpZXdQbHVnaW4pIHtcclxuICAgICAgICBzdXBlcihhcHAsIHBsdWdpbik7XHJcbiAgICAgICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XHJcbiAgICB9XHJcblxyXG4gICAgZGlzcGxheSgpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xyXG4gICAgICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XHJcblxyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAgICAgICAuc2V0TmFtZSgnXHU5RUQ4XHU4QkE0XHU4OUM2XHU1NkZFJylcclxuICAgICAgICAgICAgLnNldERlc2MoJ1x1OTAwOVx1NjJFOVx1OUVEOFx1OEJBNFx1NzY4NFx1ODlDNlx1NTZGRVx1NkEyMVx1NUYwRicpXHJcbiAgICAgICAgICAgIC5hZGREcm9wZG93bihkcm9wZG93biA9PiB7XHJcbiAgICAgICAgICAgICAgICBkcm9wZG93blxyXG4gICAgICAgICAgICAgICAgICAgIC5hZGRPcHRpb24oJ2NhcmQnLCAnXHU1MzYxXHU3MjQ3XHU4OUM2XHU1NkZFJylcclxuICAgICAgICAgICAgICAgICAgICAuYWRkT3B0aW9uKCdsaXN0JywgJ1x1NTIxN1x1ODg2OFx1ODlDNlx1NTZGRScpXHJcbiAgICAgICAgICAgICAgICAgICAgLmFkZE9wdGlvbigndGltZWxpbmUnLCAnXHU2NUY2XHU5NUY0XHU4Rjc0XHU4OUM2XHU1NkZFJylcclxuICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZGVmYXVsdFZpZXcpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09ICdjYXJkJyB8fCB2YWx1ZSA9PT0gJ2xpc3QnIHx8IHZhbHVlID09PSAndGltZWxpbmUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmRlZmF1bHRWaWV3ID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZHJvcGRvd247XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkVmlld1BsdWdpbiBleHRlbmRzIFBsdWdpbiB7XHJcbiAgICBzZXR0aW5nczogQ2FyZFZpZXdQbHVnaW5TZXR0aW5ncztcclxuXHJcbiAgICBhc3luYyBvbmxvYWQoKSB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcclxuXHJcbiAgICAgICAgdGhpcy5yZWdpc3RlclZpZXcoXHJcbiAgICAgICAgICAgIFZJRVdfVFlQRV9DQVJELFxyXG4gICAgICAgICAgICAobGVhZjogV29ya3NwYWNlTGVhZikgPT4gbmV3IENhcmRWaWV3KGxlYWYsIHRoaXMpXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRSaWJib25JY29uKCdsYXlvdXQtZ3JpZCcsICdcdTUzNjFcdTcyNDdcdTg5QzZcdTU2RkUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuYWN0aXZhdGVWaWV3KCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgQ2FyZFZpZXdTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xyXG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcclxuICAgICAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGFjdGl2YXRlVmlldygpIHtcclxuICAgICAgICBjb25zdCB7IHdvcmtzcGFjZSB9ID0gdGhpcy5hcHA7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IGxlYWYgPSB3b3Jrc3BhY2UuZ2V0TGVhdmVzT2ZUeXBlKFZJRVdfVFlQRV9DQVJEKVswXTtcclxuICAgICAgICBpZiAoIWxlYWYpIHtcclxuICAgICAgICAgICAgbGVhZiA9IHdvcmtzcGFjZS5nZXRMZWFmKCd0YWInKTtcclxuICAgICAgICAgICAgYXdhaXQgbGVhZi5zZXRWaWV3U3RhdGUoe1xyXG4gICAgICAgICAgICAgICAgdHlwZTogVklFV19UWVBFX0NBUkQsXHJcbiAgICAgICAgICAgICAgICBhY3RpdmU6IHRydWUsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB3b3Jrc3BhY2UucmV2ZWFsTGVhZihsZWFmKTtcclxuICAgIH1cclxufSAiLCAiaW1wb3J0IHtcclxuICAgIEl0ZW1WaWV3LFxyXG4gICAgV29ya3NwYWNlTGVhZixcclxuICAgIFRGaWxlLFxyXG4gICAgTWFya2Rvd25SZW5kZXJlcixcclxuICAgIE1lbnUsXHJcbiAgICBNb2RhbCxcclxuICAgIFRGb2xkZXIsXHJcbiAgICBBcHAsXHJcbiAgICBOb3RpY2VcclxufSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCBDYXJkVmlld1BsdWdpbiBmcm9tICcuL21haW4nO1xyXG5cclxuZXhwb3J0IGNvbnN0IFZJRVdfVFlQRV9DQVJEID0gJ2NhcmQtdmlldyc7XHJcblxyXG5leHBvcnQgY2xhc3MgQ2FyZFZpZXcgZXh0ZW5kcyBJdGVtVmlldyB7XHJcbiAgICBwcml2YXRlIHBsdWdpbjogQ2FyZFZpZXdQbHVnaW47XHJcbiAgICBwcml2YXRlIGN1cnJlbnRWaWV3OiAnY2FyZCcgfCAnbGlzdCcgfCAndGltZWxpbmUnO1xyXG4gICAgcHJpdmF0ZSBjb250YWluZXI6IEhUTUxFbGVtZW50O1xyXG4gICAgcHJpdmF0ZSB0YWdDb250YWluZXI6IEhUTUxFbGVtZW50O1xyXG4gICAgcHJpdmF0ZSBjb250ZW50Q29udGFpbmVyOiBIVE1MRWxlbWVudDtcclxuICAgIHByaXZhdGUgcHJldmlld0NvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XHJcbiAgICBwcml2YXRlIHByZXZpZXdSZXNpemVyOiBIVE1MRWxlbWVudDtcclxuICAgIHByaXZhdGUgaXNQcmV2aWV3Q29sbGFwc2VkOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIGN1cnJlbnRGb2xkZXI6IHN0cmluZyB8IG51bGwgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBzZWFyY2hJbnB1dDogSFRNTElucHV0RWxlbWVudDtcclxuICAgIHByaXZhdGUgY3VycmVudFNlYXJjaFRlcm06IHN0cmluZyA9ICcnO1xyXG4gICAgcHJpdmF0ZSBzZWxlY3RlZFRhZ3M6IFNldDxzdHJpbmc+ID0gbmV3IFNldCgpO1xyXG4gICAgcHJpdmF0ZSBzZWxlY3RlZE5vdGVzOiBTZXQ8c3RyaW5nPiA9IG5ldyBTZXQoKTtcclxuICAgIHByaXZhdGUgbGFzdFNlbGVjdGVkTm90ZTogc3RyaW5nIHwgbnVsbCA9IG51bGw7XHJcbiAgICBwcml2YXRlIHJlY2VudEZvbGRlcnM6IHN0cmluZ1tdID0gW107XHJcbiAgICBwcml2YXRlIGNhcmRTaXplOiBudW1iZXIgPSAyODA7ICAvLyBcdTlFRDhcdThCQTRcdTUzNjFcdTcyNDdcdTVCQkRcdTVFQTZcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgTUlOX0NBUkRfU0laRSA9IDI4MDsgIC8vIFx1NjcwMFx1NUMwRlx1NTM2MVx1NzI0N1x1NUJCRFx1NUVBNlxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBNQVhfQ0FSRF9TSVpFID0gNjAwOyAgLy8gXHU2NzAwXHU1OTI3XHU1MzYxXHU3MjQ3XHU1QkJEXHU1RUE2XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcdTY3ODRcdTkwMjBcdTUxRkRcdTY1NzBcclxuICAgICAqIEBwYXJhbSBsZWFmIC0gXHU1REU1XHU0RjVDXHU1MzNBXHU1M0Y2XHU1QjUwXHU4MjgyXHU3MEI5XHJcbiAgICAgKiBAcGFyYW0gcGx1Z2luIC0gXHU2M0QyXHU0RUY2XHU1QjlFXHU0RjhCXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKGxlYWY6IFdvcmtzcGFjZUxlYWYsIHBsdWdpbjogQ2FyZFZpZXdQbHVnaW4pIHtcclxuICAgICAgICBzdXBlcihsZWFmKTtcclxuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICAgICAgICB0aGlzLmN1cnJlbnRWaWV3ID0gcGx1Z2luLnNldHRpbmdzLmRlZmF1bHRWaWV3O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHU4M0I3XHU1M0Q2XHU4OUM2XHU1NkZFXHU3QzdCXHU1NzhCXHJcbiAgICAgKiBAcmV0dXJucyBcdTg5QzZcdTU2RkVcdTdDN0JcdTU3OEJcdTY4MDdcdThCQzZcdTdCMjZcclxuICAgICAqL1xyXG4gICAgZ2V0Vmlld1R5cGUoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gVklFV19UWVBFX0NBUkQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcdTgzQjdcdTUzRDZcdTg5QzZcdTU2RkVcdTY2M0VcdTc5M0FcdTY1ODdcdTY3MkNcclxuICAgICAqIEByZXR1cm5zIFx1NjYzRVx1NzkzQVx1NTcyOFx1NjgwN1x1N0I3RVx1OTg3NVx1NEUwQVx1NzY4NFx1NjU4N1x1NjcyQ1xyXG4gICAgICovXHJcbiAgICBnZXREaXNwbGF5VGV4dCgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiAnXHU1MzYxXHU3MjQ3XHU4OUM2XHU1NkZFJztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFx1ODlDNlx1NTZGRVx1NjI1M1x1NUYwMFx1NjVGNlx1NzY4NFx1NTIxRFx1NTlDQlx1NTMxNlx1NTFGRFx1NjU3MFxyXG4gICAgICogXHU1MjFCXHU1RUZBXHU2ODA3XHU3QjdFXHU4RkM3XHU2RUU0XHU1NjY4XHUzMDAxXHU4OUM2XHU1NkZFXHU1MjA3XHU2MzYyXHU2MzA5XHU5NEFFXHU1NDhDXHU1QkI5XHU1NjY4XHJcbiAgICAgKi9cclxuICAgIGFzeW5jIG9uT3BlbigpIHtcclxuICAgICAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xyXG4gICAgICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XHJcbiAgICAgICAgY29udGFpbmVyRWwuYWRkQ2xhc3MoJ2NhcmQtdmlldy1jb250YWluZXInKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBcdTUyMUJcdTVFRkFcdTVERTVcdTUxNzdcdTY4MEZcclxuICAgICAgICBjb25zdCB0b29sYmFyID0gY29udGFpbmVyRWwuY3JlYXRlRGl2KCdjYXJkLXZpZXctdG9vbGJhcicpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFx1NURFNlx1NEZBN1x1NURFNVx1NTE3N1x1N0VDNFxyXG4gICAgICAgIGNvbnN0IGxlZnRUb29scyA9IHRvb2xiYXIuY3JlYXRlRGl2KCd0b29sYmFyLWxlZnQnKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBcdTY1QjBcdTVFRkFcdTdCMTRcdThCQjBcdTYzMDlcdTk0QUVcclxuICAgICAgICBjb25zdCBuZXdOb3RlQnRuID0gbGVmdFRvb2xzLmNyZWF0ZUVsKCdidXR0b24nLCB7XHJcbiAgICAgICAgICAgIGNsczogJ25ldy1ub3RlLWJ1dHRvbicsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgbmV3Tm90ZUJ0bi5pbm5lckhUTUwgPSBgXHJcbiAgICAgICAgICAgIDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHdpZHRoPVwiMTZcIiBoZWlnaHQ9XCIxNlwiIHZpZXdCb3g9XCIwIDAgMjQgMjRcIiBmaWxsPVwibm9uZVwiIHN0cm9rZT1cImN1cnJlbnRDb2xvclwiIHN0cm9rZS13aWR0aD1cIjJcIiBzdHJva2UtbGluZWNhcD1cInJvdW5kXCIgc3Ryb2tlLWxpbmVqb2luPVwicm91bmRcIiBjbGFzcz1cImx1Y2lkZSBsdWNpZGUtcGx1c1wiPjxsaW5lIHgxPVwiMTJcIiB5MT1cIjVcIiB4Mj1cIjEyXCIgeTI9XCIxOVwiPjwvbGluZT48bGluZSB4MT1cIjVcIiB5MT1cIjEyXCIgeDI9XCIxOVwiIHkyPVwiMTJcIj48L2xpbmU+PC9zdmc+XHJcbiAgICAgICAgICAgIDxzcGFuPlx1NjVCMFx1NUVGQVx1N0IxNFx1OEJCMDwvc3Bhbj5cclxuICAgICAgICBgO1xyXG4gICAgICAgIG5ld05vdGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLmNyZWF0ZU5ld05vdGUoKSk7XHJcblxyXG4gICAgICAgIC8vIFx1ODlDNlx1NTZGRVx1NTIwN1x1NjM2Mlx1NjMwOVx1OTRBRVx1N0VDNFxyXG4gICAgICAgIGNvbnN0IHZpZXdTd2l0Y2hlciA9IGxlZnRUb29scy5jcmVhdGVEaXYoJ3ZpZXctc3dpdGNoZXInKTtcclxuICAgICAgICB0aGlzLmNyZWF0ZVZpZXdTd2l0Y2hlcih2aWV3U3dpdGNoZXIpO1xyXG5cclxuICAgICAgICAvLyBcdTUzRjNcdTRGQTdcdTY0MUNcdTdEMjJcdTY4NDZcclxuICAgICAgICBjb25zdCBzZWFyY2hDb250YWluZXIgPSB0b29sYmFyLmNyZWF0ZURpdignc2VhcmNoLWNvbnRhaW5lcicpO1xyXG4gICAgICAgIHRoaXMuc2VhcmNoSW5wdXQgPSBzZWFyY2hDb250YWluZXIuY3JlYXRlRWwoJ2lucHV0Jywge1xyXG4gICAgICAgICAgICB0eXBlOiAndGV4dCcsXHJcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAnXHU2NDFDXHU3RDIyXHU3QjE0XHU4QkIwLi4uJyxcclxuICAgICAgICAgICAgY2xzOiAnc2VhcmNoLWlucHV0J1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFNlYXJjaFRlcm0gPSB0aGlzLnNlYXJjaElucHV0LnZhbHVlO1xyXG4gICAgICAgICAgICB0aGlzLnJlZnJlc2hWaWV3KCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFx1NjgwN1x1N0I3RVx1NjgwRlxyXG4gICAgICAgIHRoaXMudGFnQ29udGFpbmVyID0gY29udGFpbmVyRWwuY3JlYXRlRGl2KCd0YWctZmlsdGVyJyk7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkVGFncygpO1xyXG5cclxuICAgICAgICAvLyBcdTRFM0JcdTUxODVcdTVCQjlcdTUzM0FcdTU3REZcclxuICAgICAgICBjb25zdCBjb250ZW50QXJlYSA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdignY2FyZC12aWV3LWNvbnRlbnQnKTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRlbnRBcmVhLmNyZWF0ZURpdignY2FyZC1jb250YWluZXInKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBcdTk4ODRcdTg5QzhcdTUzM0FcdTU3REZcclxuICAgICAgICBjb25zdCBwcmV2aWV3V3JhcHBlciA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdigncHJldmlldy13cmFwcGVyJyk7XHJcbiAgICAgICAgdGhpcy5wcmV2aWV3Q29udGFpbmVyID0gcHJldmlld1dyYXBwZXIuY3JlYXRlRGl2KCdwcmV2aWV3LWNvbnRhaW5lcicpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFx1OTg4NFx1ODlDOFx1NjNBN1x1NTIzNlx1NjMwOVx1OTRBRVxyXG4gICAgICAgIGNvbnN0IHByZXZpZXdDb250cm9scyA9IHByZXZpZXdXcmFwcGVyLmNyZWF0ZURpdigncHJldmlldy1jb250cm9scycpO1xyXG4gICAgICAgIGNvbnN0IHRvZ2dsZUJ1dHRvbiA9IHByZXZpZXdDb250cm9scy5jcmVhdGVFbCgnYnV0dG9uJywge1xyXG4gICAgICAgICAgICBjbHM6ICdwcmV2aWV3LXRvZ2dsZScsXHJcbiAgICAgICAgICAgIGF0dHI6IHsgJ2FyaWEtbGFiZWwnOiAnXHU2Mjk4XHU1M0UwXHU5ODg0XHU4OUM4JyB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdG9nZ2xlQnV0dG9uLmlubmVySFRNTCA9IGA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB3aWR0aD1cIjI0XCIgaGVpZ2h0PVwiMjRcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgZmlsbD1cIm5vbmVcIiBzdHJva2U9XCJjdXJyZW50Q29sb3JcIiBzdHJva2Utd2lkdGg9XCIyXCIgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZS1saW5lam9pbj1cInJvdW5kXCIgY2xhc3M9XCJmZWF0aGVyIGZlYXRoZXItY2hldnJvbi1yaWdodFwiPjxwb2x5bGluZSBwb2ludHM9XCI5IDE4IDE1IDEyIDkgNlwiPjwvcG9seWxpbmU+PC9zdmc+YDtcclxuICAgICAgICBcclxuICAgICAgICB0b2dnbGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLnRvZ2dsZVByZXZpZXcoKSk7XHJcblxyXG4gICAgICAgIHRoaXMucHJldmlld1Jlc2l6ZXIgPSBwcmV2aWV3V3JhcHBlci5jcmVhdGVEaXYoJ3ByZXZpZXctcmVzaXplcicpO1xyXG4gICAgICAgIHRoaXMuc2V0dXBSZXNpemVyKCk7XHJcblxyXG4gICAgICAgIC8vIFx1NkRGQlx1NTJBMFx1NTE2OFx1NUM0MFx1NkVEQVx1OEY2RVx1NEU4Qlx1NEVGNlx1NzZEMVx1NTQyQ1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3doZWVsJywgKGU6IFdoZWVsRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgaWYgKGUuY3RybEtleSkge1xyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZGp1c3RDYXJkU2l6ZShlLmRlbHRhWSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCB7IHBhc3NpdmU6IGZhbHNlIH0pO1xyXG5cclxuICAgICAgICBhd2FpdCB0aGlzLmxvYWROb3RlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHU1MkEwXHU4RjdEXHU2MjQwXHU2NzA5XHU2ODA3XHU3QjdFXHU1RTc2XHU1MjFCXHU1RUZBXHU2ODA3XHU3QjdFXHU4RkM3XHU2RUU0XHU1NjY4XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgYXN5bmMgbG9hZFRhZ3MoKSB7XHJcbiAgICAgICAgY29uc3QgdGFncyA9IHRoaXMuZ2V0QWxsVGFncygpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFx1NkRGQlx1NTJBMCBcIkFsbFwiIFx1NjgwN1x1N0I3RVxyXG4gICAgICAgIGNvbnN0IGFsbFRhZ0J0biA9IHRoaXMudGFnQ29udGFpbmVyLmNyZWF0ZUVsKCdidXR0b24nLCB7IFxyXG4gICAgICAgICAgICB0ZXh0OiAnQWxsJyxcclxuICAgICAgICAgICAgY2xzOiAndGFnLWJ0biBhY3RpdmUnICAvLyBcdTlFRDhcdThCQTRcdTkwMDlcdTRFMkRcclxuICAgICAgICB9KTtcclxuICAgICAgICBhbGxUYWdCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xlYXJUYWdTZWxlY3Rpb24oKTtcclxuICAgICAgICAgICAgYWxsVGFnQnRuLmFkZENsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgdGhpcy5yZWZyZXNoVmlldygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBcdTZERkJcdTUyQTBcdTUxNzZcdTRFRDZcdTY4MDdcdTdCN0VcclxuICAgICAgICB0YWdzLmZvckVhY2godGFnID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdGFnQnRuID0gdGhpcy50YWdDb250YWluZXIuY3JlYXRlRWwoJ2J1dHRvbicsIHsgXHJcbiAgICAgICAgICAgICAgICB0ZXh0OiB0YWcsXHJcbiAgICAgICAgICAgICAgICBjbHM6ICd0YWctYnRuJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGFnQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZVRhZyh0YWcsIHRhZ0J0bik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHU4M0I3XHU1M0Q2XHU2MjQwXHU2NzA5XHU3QjE0XHU4QkIwXHU0RTJEXHU3Njg0XHU2ODA3XHU3QjdFXHJcbiAgICAgKiBAcmV0dXJucyBcdTUzQkJcdTkxQ0RcdTU0MEVcdTc2ODRcdTY4MDdcdTdCN0VcdTY1NzBcdTdFQzRcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBnZXRBbGxUYWdzKCk6IHN0cmluZ1tdIHtcclxuICAgICAgICBjb25zdCB0YWdzID0gbmV3IFNldDxzdHJpbmc+KCk7XHJcbiAgICAgICAgdGhpcy5hcHAudmF1bHQuZ2V0TWFya2Rvd25GaWxlcygpLmZvckVhY2goZmlsZSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhY2hlID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoZmlsZSk7XHJcbiAgICAgICAgICAgIGlmIChjYWNoZT8udGFncykge1xyXG4gICAgICAgICAgICAgICAgY2FjaGUudGFncy5mb3JFYWNoKHRhZyA9PiB0YWdzLmFkZCh0YWcudGFnKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh0YWdzKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFx1NTIxQlx1NUVGQVx1ODlDNlx1NTZGRVx1NTIwN1x1NjM2Mlx1NjMwOVx1OTRBRVxyXG4gICAgICogQHBhcmFtIGNvbnRhaW5lciAtIFx1NjMwOVx1OTRBRVx1NUJCOVx1NTY2OFx1NTE0M1x1N0QyMFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGNyZWF0ZVZpZXdTd2l0Y2hlcihjb250YWluZXI6IEhUTUxFbGVtZW50KSB7XHJcbiAgICAgICAgY29uc3Qgdmlld3MgPSBbXHJcbiAgICAgICAgICAgIHsgaWQ6ICdjYXJkJywgaWNvbjogJ2dyaWQnLCB0ZXh0OiAnXHU1MzYxXHU3MjQ3XHU4OUM2XHU1NkZFJyB9LFxyXG4gICAgICAgICAgICB7IGlkOiAnbGlzdCcsIGljb246ICdsaXN0JywgdGV4dDogJ1x1NTIxN1x1ODg2OFx1ODlDNlx1NTZGRScgfSxcclxuICAgICAgICAgICAgeyBpZDogJ3RpbWVsaW5lJywgaWNvbjogJ2Nsb2NrJywgdGV4dDogJ1x1NjVGNlx1OTVGNFx1OEY3NFx1ODlDNlx1NTZGRScgfVxyXG4gICAgICAgIF07XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmlld3MuZm9yRWFjaCh2aWV3ID0+IHtcclxuICAgICAgICAgICAgY29uc3QgYnRuID0gY29udGFpbmVyLmNyZWF0ZUVsKCdidXR0b24nLCB7XHJcbiAgICAgICAgICAgICAgICBjbHM6IGB2aWV3LXN3aXRjaC1idG4gJHt2aWV3LmlkID09PSB0aGlzLmN1cnJlbnRWaWV3ID8gJ2FjdGl2ZScgOiAnJ31gLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFx1NzZGNFx1NjNBNVx1NEY3Rlx1NzUyOCBTVkcgXHU1NkZFXHU2ODA3XHJcbiAgICAgICAgICAgIGNvbnN0IGljb25IdG1sID0ge1xyXG4gICAgICAgICAgICAgICAgJ2dyaWQnOiAnPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgd2lkdGg9XCIxOFwiIGhlaWdodD1cIjE4XCIgdmlld0JveD1cIjAgMCAyNCAyNFwiIGZpbGw9XCJub25lXCIgc3Ryb2tlPVwiY3VycmVudENvbG9yXCIgc3Ryb2tlLXdpZHRoPVwiMlwiIHN0cm9rZS1saW5lY2FwPVwicm91bmRcIiBzdHJva2UtbGluZWpvaW49XCJyb3VuZFwiPjxyZWN0IHg9XCIzXCIgeT1cIjNcIiB3aWR0aD1cIjdcIiBoZWlnaHQ9XCI3XCI+PC9yZWN0PjxyZWN0IHg9XCIxNFwiIHk9XCIzXCIgd2lkdGg9XCI3XCIgaGVpZ2h0PVwiN1wiPjwvcmVjdD48cmVjdCB4PVwiMTRcIiB5PVwiMTRcIiB3aWR0aD1cIjdcIiBoZWlnaHQ9XCI3XCI+PC9yZWN0PjxyZWN0IHg9XCIzXCIgeT1cIjE0XCIgd2lkdGg9XCI3XCIgaGVpZ2h0PVwiN1wiPjwvcmVjdD48L3N2Zz4nLFxyXG4gICAgICAgICAgICAgICAgJ2xpc3QnOiAnPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgd2lkdGg9XCIxOFwiIGhlaWdodD1cIjE4XCIgdmlld0JveD1cIjAgMCAyNCAyNFwiIGZpbGw9XCJub25lXCIgc3Ryb2tlPVwiY3VycmVudENvbG9yXCIgc3Ryb2tlLXdpZHRoPVwiMlwiIHN0cm9rZS1saW5lY2FwPVwicm91bmRcIiBzdHJva2UtbGluZWpvaW49XCJyb3VuZFwiPjxsaW5lIHgxPVwiOFwiIHkxPVwiNlwiIHgyPVwiMjFcIiB5Mj1cIjZcIj48L2xpbmU+PGxpbmUgeDE9XCI4XCIgeTE9XCIxMlwiIHgyPVwiMjFcIiB5Mj1cIjEyXCI+PC9saW5lPjxsaW5lIHgxPVwiOFwiIHkxPVwiMThcIiB4Mj1cIjIxXCIgeTI9XCIxOFwiPjwvbGluZT48bGluZSB4MT1cIjNcIiB5MT1cIjZcIiB4Mj1cIjMuMDFcIiB5Mj1cIjZcIj48L2xpbmU+PGxpbmUgeDE9XCIzXCIgeTE9XCIxMlwiIHgyPVwiMy4wMVwiIHkyPVwiMTJcIj48L2xpbmU+PGxpbmUgeDE9XCIzXCIgeTE9XCIxOFwiIHgyPVwiMy4wMVwiIHkyPVwiMThcIj48L2xpbmU+PC9zdmc+JyxcclxuICAgICAgICAgICAgICAgICdjbG9jayc6ICc8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB3aWR0aD1cIjE4XCIgaGVpZ2h0PVwiMThcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgZmlsbD1cIm5vbmVcIiBzdHJva2U9XCJjdXJyZW50Q29sb3JcIiBzdHJva2Utd2lkdGg9XCIyXCIgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZS1saW5lam9pbj1cInJvdW5kXCI+PGNpcmNsZSBjeD1cIjEyXCIgY3k9XCIxMlwiIHI9XCIxMFwiPjwvY2lyY2xlPjxwb2x5bGluZSBwb2ludHM9XCIxMiA2IDEyIDEyIDE2IDE0XCI+PC9wb2x5bGluZT48L3N2Zz4nXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBcdTUyMUJcdTVFRkFcdTU2RkVcclxuICAgICAgICAgICAgY29uc3QgaWNvblNwYW4gPSBidG4uY3JlYXRlU3Bhbih7IGNsczogJ3ZpZXctc3dpdGNoLWljb24nIH0pO1xyXG4gICAgICAgICAgICBpY29uU3Bhbi5pbm5lckhUTUwgPSBpY29uSHRtbFt2aWV3Lmljb25dO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gXHU2REZCXHU1MkEwXHU2NTg3XHU1QjU3XHJcbiAgICAgICAgICAgIGJ0bi5jcmVhdGVTcGFuKHsgdGV4dDogdmlldy50ZXh0LCBjbHM6ICd2aWV3LXN3aXRjaC10ZXh0JyB9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcudmlldy1zd2l0Y2gtYnRuJykuZm9yRWFjaChiID0+IGIucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpKTtcclxuICAgICAgICAgICAgICAgIGJ0bi5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaFZpZXcodmlldy5pZCBhcyAnY2FyZCcgfCAnbGlzdCcgfCAndGltZWxpbmUnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcdTUyQTBcdThGN0RcdTYyNDBcdTY3MDlcdTdCMTRcdThCQjBcdTVFNzZcdTUyMUJcdTVFRkFcdTUzNjFcdTcyNDdcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBhc3luYyBsb2FkTm90ZXMoKSB7XHJcbiAgICAgICAgY29uc3QgZmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRNYXJrZG93bkZpbGVzKCk7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuZW1wdHkoKTtcclxuXHJcbiAgICAgICAgLy8gXHU0RjdGXHU3NTI4IFByb21pc2UuYWxsIFx1N0I0OVx1NUY4NVx1NjI0MFx1NjcwOVx1NTM2MVx1NzI0N1x1NTIxQlx1NUVGQVx1NUI4Q1x1NjIxMFxyXG4gICAgICAgIGNvbnN0IGNhcmRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXHJcbiAgICAgICAgICAgIGZpbGVzLm1hcChmaWxlID0+IHRoaXMuY3JlYXRlTm90ZUNhcmQoZmlsZSkpXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgLy8gXHU2REZCXHU1MkEwXHU2MjQwXHU2NzA5XHU1MzYxXHU3MjQ3XHU1MjMwXHU1QkI5XHU1NjY4XHJcbiAgICAgICAgY2FyZHMuZm9yRWFjaChjYXJkID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQoY2FyZCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcdTUyMUJcdTVFRkFcdTUzNTVcdTRFMkFcdTdCMTRcdThCQjBcdTUzNjFcdTcyNDdcclxuICAgICAqIEBwYXJhbSBmaWxlIC0gXHU3QjE0XHU4QkIwXHU2NTg3XHU0RUY2XHJcbiAgICAgKiBAcmV0dXJucyBcdTUzNjFcdTcyNDdIVE1MXHU1MTQzXHU3RDIwXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgYXN5bmMgY3JlYXRlTm90ZUNhcmQoZmlsZTogVEZpbGUpOiBQcm9taXNlPEhUTUxFbGVtZW50PiB7XHJcbiAgICAgICAgY29uc3QgY2FyZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIGNhcmQuYWRkQ2xhc3MoJ25vdGUtY2FyZCcpO1xyXG4gICAgICAgIGNhcmQuc2V0QXR0cmlidXRlKCdkYXRhLXBhdGgnLCBmaWxlLnBhdGgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFx1NTIxQlx1NUVGQVx1NTM2MVx1NzI0N1x1NTkzNFx1OTBFOFxyXG4gICAgICAgIGNvbnN0IGhlYWRlciA9IGNhcmQuY3JlYXRlRGl2KCdub3RlLWNhcmQtaGVhZGVyJyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gXHU2REZCXHU1MkEwXHU0RkVFXHU2NTM5XHU2NUY2XHU5NUY0XHJcbiAgICAgICAgY29uc3QgbGFzdE1vZGlmaWVkID0gaGVhZGVyLmNyZWF0ZURpdignbm90ZS1kYXRlJyk7XHJcbiAgICAgICAgbGFzdE1vZGlmaWVkLnNldFRleHQobmV3IERhdGUoZmlsZS5zdGF0Lm10aW1lKS50b0xvY2FsZURhdGVTdHJpbmcoKSk7XHJcblxyXG4gICAgICAgIC8vIFx1NEZFRVx1NjUzOVx1NjU4N1x1NEVGNlx1NTkzOVx1OERFRlx1NUY4NFx1NzY4NFx1NTIxQlx1NUVGQVx1NTQ4Q1x1NjgzN1x1NUYwRlxyXG4gICAgICAgIGNvbnN0IGZvbGRlclBhdGggPSBoZWFkZXIuY3JlYXRlRGl2KCdub3RlLWZvbGRlcicpO1xyXG4gICAgICAgIGNvbnN0IGZvbGRlciA9IGZpbGUucGFyZW50ID8gKGZpbGUucGFyZW50LnBhdGggPT09ICcvJyA/ICdcdTY4MzlcdTc2RUVcdTVGNTUnIDogZmlsZS5wYXJlbnQucGF0aCkgOiAnXHU2ODM5XHU3NkVFXHU1RjU1JztcclxuICAgICAgICBmb2xkZXJQYXRoLnNldFRleHQoZm9sZGVyKTtcclxuICAgICAgICBmb2xkZXJQYXRoLnNldEF0dHJpYnV0ZSgndGl0bGUnLCBgXHU2MjUzXHU1RjAwXHU2NTg3XHU0RUY2XHU1OTM5OiAke2ZvbGRlcn1gKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBcdTZERkJcdTUyQTBcdTcwQjlcdTUxRkJcdTRFOEJcdTRFRjZcclxuICAgICAgICBmb2xkZXJQYXRoLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKGUpID0+IHtcclxuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgLy8gXHU2MjUzXHU1RjAwXHU2NTg3XHU0RUY2XHU1OTM5XHJcbiAgICAgICAgICAgIGNvbnN0IGZpbGVFeHBsb3JlciA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoJ2ZpbGUtZXhwbG9yZXInKVswXTtcclxuICAgICAgICAgICAgaWYgKGZpbGVFeHBsb3Jlcikge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZmlsZUV4cGxvcmVyVmlldyA9IGZpbGVFeHBsb3Jlci52aWV3IGFzIGFueTtcclxuICAgICAgICAgICAgICAgIGlmIChmaWxlRXhwbG9yZXJWaWV3LmV4cGFuZEZvbGRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucmV2ZWFsRm9sZGVySW5FeHBsb3Jlcihmb2xkZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFx1ODA1QVx1NzEyNlx1NTIzMFx1NjU4N1x1NEVGNlx1NkQ0Rlx1ODlDOFx1NTY2OFxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGVFeHBsb3Jlci5zZXRFcGhlbWVyYWxTdGF0ZSh7IGZvY3VzOiB0cnVlIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFx1NkRGQlx1NTJBMFx1NjI1M1x1NUYwMFx1NjMwOVx1OTRBRVxyXG4gICAgICAgIGNvbnN0IG9wZW5CdXR0b24gPSBoZWFkZXIuY3JlYXRlRGl2KCdub3RlLW9wZW4tYnV0dG9uJyk7XHJcbiAgICAgICAgb3BlbkJ1dHRvbi5pbm5lckhUTUwgPSBgPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgd2lkdGg9XCIxNlwiIGhlaWdodD1cIjE2XCIgdmlld0JveD1cIjAgMCAyNCAyNFwiIGZpbGw9XCJub25lXCIgc3Ryb2tlPVwiY3VycmVudENvbG9yXCIgc3Ryb2tlLXdpZHRoPVwiMlwiIHN0cm9rZS1saW5lY2FwPVwicm91bmRcIiBzdHJva2UtbGluZWpvaW49XCJyb3VuZFwiPjxwYXRoIGQ9XCJNMTggMTN2NmEyIDIgMCAwIDEtMiAySDVhMiAyIDAgMCAxLTItMlY4YTIgMiAwIDAgMSAyLTJoNlwiPjwvcGF0aD48cG9seWxpbmUgcG9pbnRzPVwiMTUgMyAyMSAzIDIxIDlcIj48L3BvbHlsaW5lPjxsaW5lIHgxPVwiMTBcIiB5MT1cIjE0XCIgeDI9XCIyMVwiIHkyPVwiM1wiPjwvbGluZT48L3N2Zz5gO1xyXG4gICAgICAgIG9wZW5CdXR0b24uc2V0QXR0cmlidXRlKCd0aXRsZScsICdcdTU3MjhcdTY1QjBcdTY4MDdcdTdCN0VcdTk4NzVcdTRFMkRcdTYyNTNcdTVGMDAnKTtcclxuICAgICAgICBvcGVuQnV0dG9uLnN0eWxlLm9wYWNpdHkgPSAnMCc7ICAvLyBcdTlFRDhcdThCQTRcdTk2OTBcdTg1Q0ZcclxuXHJcbiAgICAgICAgLy8gXHU1MjFCXHU1RUZBXHU1MzYxXHU3MjQ3XHU1MTg1XHU1QkI5XHU1QkI5XHU1NjY4XHJcbiAgICAgICAgY29uc3QgY2FyZENvbnRlbnQgPSBjYXJkLmNyZWF0ZURpdignbm90ZS1jYXJkLWNvbnRlbnQnKTtcclxuXHJcbiAgICAgICAgLy8gXHU1OTA0XHU3NDA2XHU2ODA3XHU5ODk4XHVGRjA4XHU3OUZCXHU1MjMwXHU1MTg1XHU1QkI5XHU1MzNBXHU1N0RGXHU5ODc2XHU5MEU4XHVGRjA5XHJcbiAgICAgICAgY29uc3QgdGl0bGUgPSBjYXJkQ29udGVudC5jcmVhdGVEaXYoJ25vdGUtdGl0bGUnKTtcclxuICAgICAgICBsZXQgZGlzcGxheVRpdGxlID0gZmlsZS5iYXNlbmFtZTtcclxuICAgICAgICAvLyBcdTU5MDRcdTc0MDZcdTY1RTVcdTY3MUZcdTVGMDBcdTU5MzRcdTc2ODRcdTY4MDdcdTk4OThcclxuICAgICAgICBjb25zdCB0aW1lUGF0dGVybiA9IC9eXFxkezR9Wy0uL11cXGR7Mn1bLS4vXVxcZHsyfS87XHJcbiAgICAgICAgaWYgKHRpbWVQYXR0ZXJuLnRlc3QoZGlzcGxheVRpdGxlKSkge1xyXG4gICAgICAgICAgICBkaXNwbGF5VGl0bGUgPSBkaXNwbGF5VGl0bGUucmVwbGFjZSh0aW1lUGF0dGVybiwgJycpLnRyaW0oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGl0bGUuc2V0VGV4dChkaXNwbGF5VGl0bGUpO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvLyBcdThCRkJcdTUzRDZcdTdCMTRcdThCQjBcdTUxODVcdTVCQjlcclxuICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBcdTUyMUJcdTVFRkFcdTdCMTRcdThCQjBcdTUxODVcdTVCQjlcdTVCQjlcdTU2NjhcclxuICAgICAgICAgICAgY29uc3Qgbm90ZUNvbnRlbnQgPSBjYXJkQ29udGVudC5jcmVhdGVEaXYoJ25vdGUtY29udGVudCcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gXHU2RTMyXHU2N0QzIE1hcmtkb3duIFx1NTE4NVx1NUJCOVxyXG4gICAgICAgICAgICBhd2FpdCBNYXJrZG93blJlbmRlcmVyLnJlbmRlck1hcmtkb3duKFxyXG4gICAgICAgICAgICAgICAgY29udGVudCxcclxuICAgICAgICAgICAgICAgIG5vdGVDb250ZW50LFxyXG4gICAgICAgICAgICAgICAgZmlsZS5wYXRoLFxyXG4gICAgICAgICAgICAgICAgdGhpc1xyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgLy8gXHU5RjIwXHU2ODA3XHU2MEFDXHU1MDVDXHU0RThCXHU0RUY2XHJcbiAgICAgICAgICAgIGNhcmQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgICAgIG9wZW5CdXR0b24uc3R5bGUub3BhY2l0eSA9ICcxJzsgIC8vIFx1NjYzRVx1NzkzQVx1NjI1M1x1NUYwMFx1NjMwOVx1OTRBRVxyXG4gICAgICAgICAgICAgICAgdGl0bGUuc3R5bGUub3BhY2l0eSA9ICcwJztcclxuICAgICAgICAgICAgICAgIG5vdGVDb250ZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBcdTU3MjhcdTk4ODRcdTg5QzhcdTY4MEZcdTRFMkRcdTY2M0VcdTc5M0FcdTVCOENcdTY1NzRcdTUxODVcdTVCQjlcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmV2aWV3Q29udGFpbmVyLmVtcHR5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgTWFya2Rvd25SZW5kZXJlci5yZW5kZXJNYXJrZG93bihcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmV2aWV3Q29udGFpbmVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnBhdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdcdTk4ODRcdTg5QzhcdTUyQTBcdThGN0RcdTU5MzFcdThEMjU6JywgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNhcmQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIG9wZW5CdXR0b24uc3R5bGUub3BhY2l0eSA9ICcwJzsgIC8vIFx1OTY5MFx1ODVDRlx1NjI1M1x1NUYwMFx1NjMwOVx1OTRBRVxyXG4gICAgICAgICAgICAgICAgdGl0bGUuc3R5bGUub3BhY2l0eSA9ICcxJztcclxuICAgICAgICAgICAgICAgIG5vdGVDb250ZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gXHU0RkVFXHU2NTM5XHU0RThCXHU0RUY2XHU3NkQxXHU1NDJDXHJcbiAgICAgICAgICAgIG9wZW5CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZigndGFiJyk7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBsZWFmLm9wZW5GaWxlKGZpbGUpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIFx1NTM1NVx1NTFGQlx1OTAwOVx1NjJFOVxyXG4gICAgICAgICAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlQ2FyZFNlbGVjdGlvbihmaWxlLnBhdGgsIGUpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIFx1NTNDQ1x1NTFGQlx1NjI1M1x1NUYwMFxyXG4gICAgICAgICAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoJ2RibGNsaWNrJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKCd0YWInKTtcclxuICAgICAgICAgICAgICAgIGF3YWl0IGxlYWYub3BlbkZpbGUoZmlsZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gXHU1M0YzXHU5NTJFXHU4M0RDXHU1MzU1XHJcbiAgICAgICAgICAgIGNhcmQuYWRkRXZlbnRMaXN0ZW5lcignY29udGV4dG1lbnUnLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93Q29udGV4dE1lbnUoZSwgdGhpcy5nZXRTZWxlY3RlZEZpbGVzKCkpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignXHU3QjE0XHU4QkIwXHU1MkEwXHU4RjdEXHU1OTMxXHU4RDI1OicsIGVycm9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFx1NkRGQlx1NTJBMFx1NTM2MVx1NzI0N1x1NjBBQ1x1NTA1Q1x1NEU4Qlx1NEVGNlxyXG4gICAgICAgIGNhcmQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgb3BlbkJ1dHRvbi5zdHlsZS5vcGFjaXR5ID0gJzEnOyAgLy8gXHU2NjNFXHU3OTNBXHU2MjUzXHU1RjAwXHU2MzA5XHU5NEFFXHJcbiAgICAgICAgICAgIC8vIC4uLiBcdTUxNzZcdTRFRDZcdTYwQUNcdTUwNUNcdTRFOEJcdTRFRjZcdTRFRTNcdTc4MDEgLi4uXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNhcmQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsICgpID0+IHtcclxuICAgICAgICAgICAgb3BlbkJ1dHRvbi5zdHlsZS5vcGFjaXR5ID0gJzAnOyAgLy8gXHU5NjkwXHU4NUNGXHU2MjUzXHU1RjAwXHU2MzA5XHU5NEFFXHJcbiAgICAgICAgICAgIC8vIC4uLiBcdTUxNzZcdTRFRDZcdTc5QkJcdTVGMDBcdTRFOEJcdTRFRjZcdTRFRTNcdTc4MDEgLi4uXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBjYXJkO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHU1MjA3XHU2MzYyXHU4OUM2XHU1NkZFXHU2QTIxXHU1RjBGXHJcbiAgICAgKiBAcGFyYW0gdmlldyAtIFx1NzZFRVx1NjgwN1x1ODlDNlx1NTZGRVx1NkEyMVx1NUYwRlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHN3aXRjaFZpZXcodmlldzogJ2NhcmQnIHwgJ2xpc3QnIHwgJ3RpbWVsaW5lJykge1xyXG4gICAgICAgIHRoaXMuY3VycmVudFZpZXcgPSB2aWV3O1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLnNldEF0dHJpYnV0ZSgnZGF0YS12aWV3Jywgdmlldyk7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuZW1wdHkoKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAodmlldyA9PT0gJ3RpbWVsaW5lJykge1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZVRpbWVsaW5lVmlldygpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZE5vdGVzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHU2ODM5XHU2MzZFXHU2ODA3XHU3QjdFXHU4RkM3XHU2RUU0XHU3QjE0XHU4QkIwXHJcbiAgICAgKiBAcGFyYW0gdGFnIC0gXHU2ODA3XHU3QjdFXHU1NDBEXHU3OUYwXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgYXN5bmMgZmlsdGVyQnlUYWcodGFnOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBmaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldE1hcmtkb3duRmlsZXMoKTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5lbXB0eSgpO1xyXG5cclxuICAgICAgICBjb25zdCBmaWx0ZXJlZEZpbGVzID0gZmlsZXMuZmlsdGVyKGZpbGUgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjYWNoZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKGZpbGUpO1xyXG4gICAgICAgICAgICByZXR1cm4gY2FjaGU/LnRhZ3M/LnNvbWUodCA9PiB0LnRhZyA9PT0gdGFnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gXHU0RjdGXHU3NTI4IFByb21pc2UuYWxsIFx1N0I0OVx1NUY4NVx1NjI0MFx1NjcwOVx1NTM2MVx1NzI0N1x1NTIxQlx1NUVGQVx1NUI4Q1x1NjIxMFxyXG4gICAgICAgIGNvbnN0IGNhcmRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXHJcbiAgICAgICAgICAgIGZpbHRlcmVkRmlsZXMubWFwKGZpbGUgPT4gdGhpcy5jcmVhdGVOb3RlQ2FyZChmaWxlKSlcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICAvLyBcdTZERkJcdTUyQTBcdTYyNDBcdTY3MDlcdTUzNjFcdTcyNDdcdTUyMzBcdTVCQjlcdTU2NjhcclxuICAgICAgICBjYXJkcy5mb3JFYWNoKGNhcmQgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZChjYXJkKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gXHU5QUQ4XHU0RUFFXHU5MDA5XHU0RTJEXHU3Njg0XHU2ODA3XHU3QjdFXHJcbiAgICAgICAgdGhpcy50YWdDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnYnV0dG9uJykuZm9yRWFjaChidG4gPT4ge1xyXG4gICAgICAgICAgICBpZiAoYnRuLnRleHRDb250ZW50ID09PSB0YWcpIHtcclxuICAgICAgICAgICAgICAgIGJ0bi5hZGRDbGFzcygnYWN0aXZlLXRhZycpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYnRuLnJlbW92ZUNsYXNzKCdhY3RpdmUtdGFnJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHRvZ2dsZVByZXZpZXcoKSB7XHJcbiAgICAgICAgdGhpcy5pc1ByZXZpZXdDb2xsYXBzZWQgPSAhdGhpcy5pc1ByZXZpZXdDb2xsYXBzZWQ7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNQcmV2aWV3Q29sbGFwc2VkKSB7XHJcbiAgICAgICAgICAgIHRoaXMucHJldmlld0NvbnRhaW5lci5hZGRDbGFzcygnY29sbGFwc2VkJyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5wcmV2aWV3Q29udGFpbmVyLnJlbW92ZUNsYXNzKCdjb2xsYXBzZWQnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXR1cFJlc2l6ZXIoKSB7XHJcbiAgICAgICAgbGV0IHN0YXJ0WDogbnVtYmVyO1xyXG4gICAgICAgIGxldCBzdGFydFdpZHRoOiBudW1iZXI7XHJcblxyXG4gICAgICAgIGNvbnN0IHN0YXJ0UmVzaXplID0gKGU6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICBzdGFydFggPSBlLnBhZ2VYO1xyXG4gICAgICAgICAgICBzdGFydFdpZHRoID0gcGFyc2VJbnQoZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLnByZXZpZXdDb250YWluZXIpLndpZHRoLCAxMCk7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHJlc2l6ZSk7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBzdG9wUmVzaXplKTtcclxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAnY29sLXJlc2l6ZSc7XHJcbiAgICAgICAgICAgIHRoaXMucHJldmlld1Jlc2l6ZXIuYWRkQ2xhc3MoJ3Jlc2l6aW5nJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgcmVzaXplID0gKGU6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qgd2lkdGggPSBzdGFydFdpZHRoIC0gKGUucGFnZVggLSBzdGFydFgpO1xyXG4gICAgICAgICAgICBpZiAod2lkdGggPj0gNTAgJiYgd2lkdGggPD0gODAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnByZXZpZXdDb250YWluZXIuc3R5bGUud2lkdGggPSBgJHt3aWR0aH1weGA7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1ByZXZpZXdDb2xsYXBzZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzUHJldmlld0NvbGxhcHNlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJldmlld0NvbnRhaW5lci5yZW1vdmVDbGFzcygnY29sbGFwc2VkJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBzdG9wUmVzaXplID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCByZXNpemUpO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgc3RvcFJlc2l6ZSk7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yID0gJyc7XHJcbiAgICAgICAgICAgIHRoaXMucHJldmlld1Jlc2l6ZXIucmVtb3ZlQ2xhc3MoJ3Jlc2l6aW5nJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5wcmV2aWV3UmVzaXplci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBzdGFydFJlc2l6ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBoaWdobGlnaHRGb2xkZXIoZm9sZGVyOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLmN1cnJlbnRGb2xkZXIgPSB0aGlzLmN1cnJlbnRGb2xkZXIgPT09IGZvbGRlciA/IG51bGwgOiBmb2xkZXI7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLm5vdGUtY2FyZCcpLmZvckVhY2goY2FyZCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZvbGRlckVsZW1lbnQgPSBjYXJkLnF1ZXJ5U2VsZWN0b3IoJy5ub3RlLWZvbGRlcicpO1xyXG4gICAgICAgICAgICBjb25zdCBjYXJkRm9sZGVyID0gZm9sZGVyRWxlbWVudCA/IGZvbGRlckVsZW1lbnQudGV4dENvbnRlbnQgOiBudWxsO1xyXG4gICAgICAgICAgICBpZiAoY2FyZEZvbGRlcikge1xyXG4gICAgICAgICAgICAgICAgY2FyZC50b2dnbGVDbGFzcygnZm9sZGVyLWhpZ2hsaWdodCcsIGNhcmRGb2xkZXIgPT09IGZvbGRlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFzeW5jIHJldmVhbEZvbGRlckluRXhwbG9yZXIoZm9sZGVyOiBzdHJpbmcpIHtcclxuICAgICAgICAvLyBcdTgzQjdcdTUzRDZcdTY1ODdcdTRFRjZcdTZENEZcdTg5QzhcdTU2NjhcdTg5QzZcdTU2RkVcclxuICAgICAgICBjb25zdCBmaWxlRXhwbG9yZXIgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhdmVzT2ZUeXBlKCdmaWxlLWV4cGxvcmVyJylbMF07XHJcbiAgICAgICAgaWYgKGZpbGVFeHBsb3Jlcikge1xyXG4gICAgICAgICAgICBjb25zdCBmaWxlRXhwbG9yZXJWaWV3ID0gZmlsZUV4cGxvcmVyLnZpZXcgYXMgYW55O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gXHU1OTgyXHU2NzlDXHU2NjJGXHU2ODM5XHU3NkVFXHU1RjU1XHVGRjBDXHU3NkY0XHU2M0E1XHU1QzU1XHU1RjAwXHU2ODM5XHU3NkVFXHU1RjU1XHJcbiAgICAgICAgICAgIGlmIChmb2xkZXIgPT09ICdcdTY4MzlcdTc2RUVcdTVGNTUnKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmlsZUV4cGxvcmVyVmlldy5leHBhbmRGb2xkZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBmaWxlRXhwbG9yZXJWaWV3LmV4cGFuZEZvbGRlcignLycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBcdTVDNTVcdTVGMDBcdTVFNzZcdTkwMDlcdTRFMkRcdTY1ODdcdTRFRjZcdTU5MzlcclxuICAgICAgICAgICAgaWYgKGZpbGVFeHBsb3JlclZpZXcuZXhwYW5kRm9sZGVyKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBcdTVDNTVcdTVGMDBcdTcyMzZcdTY1ODdcdTRFRjZcdTU5MzlcdThERUZcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZvbGRlclBhcnRzID0gZm9sZGVyLnNwbGl0KCcvJyk7XHJcbiAgICAgICAgICAgICAgICBsZXQgY3VycmVudFBhdGggPSAnJztcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gXHU5MDEwXHU3RUE3XHU1QzU1XHU1RjAwXHU2NTg3XHU0RUY2XHU1OTM5XHJcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgZm9sZGVyUGFydHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50UGF0aCArPSAoY3VycmVudFBhdGggPyAnLycgOiAnJykgKyBwYXJ0O1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGZpbGVFeHBsb3JlclZpZXcuZXhwYW5kRm9sZGVyKGN1cnJlbnRQYXRoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBcdTkwMDlcdTRFMkRcdTc2RUVcdTY4MDdcdTY1ODdcdTRFRjZcdTU5MzlcclxuICAgICAgICAgICAgICAgIGlmIChmaWxlRXhwbG9yZXJWaWV3LnNldFNlbGVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGZpbGVFeHBsb3JlclZpZXcuc2V0U2VsZWN0aW9uKGZvbGRlcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhc3luYyBjcmVhdGVOZXdOb3RlKCkge1xyXG4gICAgICAgIC8vIFx1ODNCN1x1NTNENlx1NUY1M1x1NTI0RFx1NjVFNVx1NjcxRlx1NEY1Q1x1NEUzQVx1OUVEOFx1OEJBNFx1NjU4N1x1NEVGNlx1NTQwRFxyXG4gICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgIGNvbnN0IGZpbGVOYW1lID0gYFx1NjcyQVx1NTQ3RFx1NTQwRFx1N0IxNFx1OEJCMCAke2RhdGUudG9Mb2NhbGVTdHJpbmcoKS5yZXBsYWNlKC9bLzpdL2csICctJyl9YDtcclxuICAgICAgICBcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvLyBcdTUyMUJcdTVFRkFcdTY1QjBcdTdCMTRcdThCQjBcclxuICAgICAgICAgICAgY29uc3QgZmlsZSA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZShcclxuICAgICAgICAgICAgICAgIGAke2ZpbGVOYW1lfS5tZGAsXHJcbiAgICAgICAgICAgICAgICAnIyAnICsgZmlsZU5hbWUgKyAnXFxuXFxuJ1xyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gXHU1NzI4XHU2NUIwXHU2ODA3XHU3QjdFXHU5ODc1XHU0RTJEXHU2MjUzXHU1RjAwXHU3QjE0XHU4QkIwXHJcbiAgICAgICAgICAgIGNvbnN0IGxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZigndGFiJyk7XHJcbiAgICAgICAgICAgIGF3YWl0IGxlYWYub3BlbkZpbGUoZmlsZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBcdTUyMzdcdTY1QjBcdTUzNjFcdTcyNDdcdTg5QzZcdTU2RkVcclxuICAgICAgICAgICAgdGhpcy5sb2FkTm90ZXMoKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdcdTUyMUJcdTVFRkFcdTdCMTRcdThCQjBcdTU5MzFcdThEMjU6JywgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFzeW5jIGNyZWF0ZVRpbWVsaW5lVmlldygpIHtcclxuICAgICAgICBjb25zdCB0aW1lbGluZUNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyLmNyZWF0ZURpdigndGltZWxpbmUtY29udGFpbmVyJyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gXHU4M0I3XHU1M0Q2XHU2MjQwXHU2NzA5XHU3QjE0XHU4QkIwXHU1RTc2XHU2MzA5XHU2NUU1XHU2NzFGXHU1MjA2XHU3RUM0XHJcbiAgICAgICAgY29uc3QgZmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRNYXJrZG93bkZpbGVzKCk7XHJcbiAgICAgICAgY29uc3Qgbm90ZXNCeURhdGUgPSBuZXcgTWFwPHN0cmluZywgVEZpbGVbXT4oKTtcclxuICAgICAgICBcclxuICAgICAgICBmaWxlcy5mb3JFYWNoKGZpbGUgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoZmlsZS5zdGF0Lm10aW1lKS50b0xvY2FsZURhdGVTdHJpbmcoKTtcclxuICAgICAgICAgICAgaWYgKCFub3Rlc0J5RGF0ZS5oYXMoZGF0ZSkpIHtcclxuICAgICAgICAgICAgICAgIG5vdGVzQnlEYXRlLnNldChkYXRlLCBbXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3Qgbm90ZXMgPSBub3Rlc0J5RGF0ZS5nZXQoZGF0ZSk7XHJcbiAgICAgICAgICAgIGlmIChub3Rlcykge1xyXG4gICAgICAgICAgICAgICAgbm90ZXMucHVzaChmaWxlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBcdTYzMDlcdTY1RTVcdTY3MUZcdTYzOTJcdTVFOEZcclxuICAgICAgICBjb25zdCBzb3J0ZWREYXRlcyA9IEFycmF5LmZyb20obm90ZXNCeURhdGUua2V5cygpKS5zb3J0KChhLCBiKSA9PiBcclxuICAgICAgICAgICAgbmV3IERhdGUoYikuZ2V0VGltZSgpIC0gbmV3IERhdGUoYSkuZ2V0VGltZSgpXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgLy8gXHU1MjFCXHU1RUZBXHU2NUY2XHU5NUY0XHU4Rjc0XHJcbiAgICAgICAgZm9yIChjb25zdCBkYXRlIG9mIHNvcnRlZERhdGVzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGVHcm91cCA9IHRpbWVsaW5lQ29udGFpbmVyLmNyZWF0ZURpdigndGltZWxpbmUtZGF0ZS1ncm91cCcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gXHU1MjFCXHU1RUZBXHU2NUU1XHU2NzFGXHU4MjgyXHU3MEI5XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGVOb2RlID0gZGF0ZUdyb3VwLmNyZWF0ZURpdigndGltZWxpbmUtZGF0ZS1ub2RlJyk7XHJcbiAgICAgICAgICAgIGRhdGVOb2RlLmNyZWF0ZURpdigndGltZWxpbmUtbm9kZS1jaXJjbGUnKTtcclxuICAgICAgICAgICAgZGF0ZU5vZGUuY3JlYXRlRGl2KCd0aW1lbGluZS1kYXRlLWxhYmVsJykuc2V0VGV4dChkYXRlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFx1NTIxQlx1NUVGQVx1N0IxNFx1OEJCMFx1NTIxN1x1ODg2OFxyXG4gICAgICAgICAgICBjb25zdCBub3Rlc0xpc3QgPSBkYXRlR3JvdXAuY3JlYXRlRGl2KCd0aW1lbGluZS1ub3Rlcy1saXN0Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IG5vdGVzID0gbm90ZXNCeURhdGUuZ2V0KGRhdGUpO1xyXG4gICAgICAgICAgICBpZiAobm90ZXMpIHtcclxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBub3Rlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vdGVJdGVtID0gbm90ZXNMaXN0LmNyZWF0ZURpdigndGltZWxpbmUtbm90ZS1pdGVtJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gXHU1MjFCXHU1RUZBXHU2ODA3XHU4QkIwXHU3RUJGXHJcbiAgICAgICAgICAgICAgICAgICAgbm90ZUl0ZW0uY3JlYXRlRGl2KCd0aW1lbGluZS1ub3RlLW1hcmtlcicpO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFx1NTIxQlx1NUVGQVx1N0IxNFx1OEJCMFx1NTE4NVx1NUJCOVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vdGVDb250ZW50ID0gbm90ZUl0ZW0uY3JlYXRlRGl2KCd0aW1lbGluZS1ub3RlLWNvbnRlbnQnKTtcclxuICAgICAgICAgICAgICAgICAgICBub3RlQ29udGVudC5jcmVhdGVEaXYoJ3RpbWVsaW5lLW5vdGUtdGl0bGUnKS5zZXRUZXh0KGZpbGUuYmFzZW5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFx1NkRGQlx1NTJBMFx1NzBCOVx1NTFGQlx1NEU4Qlx1NEVGNlxyXG4gICAgICAgICAgICAgICAgICAgIG5vdGVJdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsZWFmID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoJ3RhYicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBsZWFmLm9wZW5GaWxlKGZpbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBcdTZERkJcdTUyQTBcdTk4ODRcdTg5QzhcdTUyOUZcdTgwRkRcclxuICAgICAgICAgICAgICAgICAgICBub3RlSXRlbS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmV2aWV3Q29udGFpbmVyLmVtcHR5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IE1hcmtkb3duUmVuZGVyZXIucmVuZGVyTWFya2Rvd24oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXZpZXdDb250YWluZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5wYXRoLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdcdTk4ODRcdTg5QzhcdTUyQTBcdThGN0RcdTU5MzFcdThEMjU6JywgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gXHU2REZCXHU1MkEwXHU1M0YzXHU5NTJFXHU4M0RDXHU1MzU1XHU1MjlGXHU4MEZEXHJcbiAgICBwcml2YXRlIGFkZENvbnRleHRNZW51KGNhcmQ6IEhUTUxFbGVtZW50LCBmaWxlOiBURmlsZSkge1xyXG4gICAgICAgIGNhcmQuYWRkRXZlbnRMaXN0ZW5lcignY29udGV4dG1lbnUnLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBcdTU5ODJcdTY3OUNcdTcwQjlcdTUxRkJcdTc2ODRcdTUzNjFcdTcyNDdcdTZDQTFcdTY3MDlcdTg4QUJcdTkwMDlcdTRFMkRcdUZGMENcdTRFMTRcdTZDQTFcdTY3MDlcdTYzMDlcdTRGNEYgQ3RybCBcdTk1MkVcdUZGMENcclxuICAgICAgICAgICAgLy8gXHU1MjE5XHU2RTA1XHU5NjY0XHU1MTc2XHU0RUQ2XHU5MDA5XHU2MkU5XHU1RTc2XHU5MDA5XHU0RTJEXHU1RjUzXHU1MjREXHU1MzYxXHU3MjQ3XHJcbiAgICAgICAgICAgIGNvbnN0IHBhdGggPSBjYXJkLmdldEF0dHJpYnV0ZSgnZGF0YS1wYXRoJyk7XHJcbiAgICAgICAgICAgIGlmIChwYXRoICYmICF0aGlzLnNlbGVjdGVkTm90ZXMuaGFzKHBhdGgpICYmICFldmVudC5jdHJsS2V5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyU2VsZWN0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkTm90ZXMuYWRkKHBhdGgpO1xyXG4gICAgICAgICAgICAgICAgY2FyZC5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRGaWxlcyA9IHRoaXMuZ2V0U2VsZWN0ZWRGaWxlcygpO1xyXG4gICAgICAgICAgICB0aGlzLnNob3dDb250ZXh0TWVudShldmVudCwgc2VsZWN0ZWRGaWxlcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gXHU1MjM3XHU2NUIwXHU4OUM2XHU1NkZFXHVGRjA4XHU3NTI4XHU0RThFXHU2NDFDXHU3RDIyXHU1NDhDXHU4RkM3XHU2RUU0XHVGRjA5XHJcbiAgICBwcml2YXRlIGFzeW5jIHJlZnJlc2hWaWV3KCkge1xyXG4gICAgICAgIGNvbnN0IGZpbGVzID0gdGhpcy5hcHAudmF1bHQuZ2V0TWFya2Rvd25GaWxlcygpO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLmVtcHR5KCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGZpbHRlcmVkRmlsZXMgPSBmaWxlcy5maWx0ZXIoZmlsZSA9PiB7XHJcbiAgICAgICAgICAgIC8vIFx1NjQxQ1x1N0QyMlx1OEZDN1x1NkVFNFxyXG4gICAgICAgICAgICBjb25zdCBtYXRjaGVzU2VhcmNoID0gIXRoaXMuY3VycmVudFNlYXJjaFRlcm0gfHwgXHJcbiAgICAgICAgICAgICAgICBmaWxlLmJhc2VuYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModGhpcy5jdXJyZW50U2VhcmNoVGVybS50b0xvd2VyQ2FzZSgpKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFx1NjgwN1x1N0I3RVx1OEZDN1x1NkVFNFxyXG4gICAgICAgICAgICBsZXQgbWF0Y2hlc1RhZ3MgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFRhZ3Muc2l6ZSA+IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNhY2hlID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoZmlsZSk7XHJcbiAgICAgICAgICAgICAgICBtYXRjaGVzVGFncyA9IGNhY2hlPy50YWdzPy5zb21lKHQgPT4gdGhpcy5zZWxlY3RlZFRhZ3MuaGFzKHQudGFnKSkgPz8gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBtYXRjaGVzU2VhcmNoICYmIG1hdGNoZXNUYWdzO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBcdTRGN0ZcdTc1MjggUHJvbWlzZS5hbGwgXHU3QjQ5XHU1Rjg1XHU2MjQwXHU2NzA5XHU1MzYxXHU3MjQ3XHU1MjFCXHU1RUZBXHU1QjhDXHU2MjEwXHJcbiAgICAgICAgY29uc3QgY2FyZHMgPSBhd2FpdCBQcm9taXNlLmFsbChcclxuICAgICAgICAgICAgZmlsdGVyZWRGaWxlcy5tYXAoZmlsZSA9PiB0aGlzLmNyZWF0ZU5vdGVDYXJkKGZpbGUpKVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIC8vIFx1NkRGQlx1NTJBMFx1NjI0MFx1NjcwOVx1NTM2MVx1NzI0N1x1NTIzMFx1NUJCOVx1NTY2OFxyXG4gICAgICAgIGNhcmRzLmZvckVhY2goY2FyZCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKGNhcmQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFx1NkRGQlx1NTJBMFx1NjgwN1x1N0I3RVx1NTIwN1x1NjM2Mlx1NjVCOVx1NkNENVxyXG4gICAgcHJpdmF0ZSB0b2dnbGVUYWcodGFnOiBzdHJpbmcsIHRhZ0J0bjogSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFRhZ3MuaGFzKHRhZykpIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFRhZ3MuZGVsZXRlKHRhZyk7XHJcbiAgICAgICAgICAgIHRhZ0J0bi5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFRhZ3MuYWRkKHRhZyk7XHJcbiAgICAgICAgICAgIHRhZ0J0bi5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBcdTUzRDZcdTZEODggXCJBbGxcIiBcdTY4MDdcdTdCN0VcdTc2ODRcdTkwMDlcdTRFMkRcdTcyQjZcdTYwMDFcclxuICAgICAgICBjb25zdCBhbGxCdG4gPSB0aGlzLnRhZ0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdidXR0b24nKTtcclxuICAgICAgICBpZiAoYWxsQnRuKSB7XHJcbiAgICAgICAgICAgIGFsbEJ0bi5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnJlZnJlc2hWaWV3KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gXHU2REZCXHU1MkEwXHU2RTA1XHU5NjY0XHU2ODA3XHU3QjdFXHU5MDA5XHU2MkU5XHU2NUI5XHU2Q0Q1XHJcbiAgICBwcml2YXRlIGNsZWFyVGFnU2VsZWN0aW9uKCkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRUYWdzLmNsZWFyKCk7XHJcbiAgICAgICAgdGhpcy50YWdDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnRhZy1idG4nKS5mb3JFYWNoKGJ0biA9PiB7XHJcbiAgICAgICAgICAgIGJ0bi5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gXHU1OTA0XHU3NDA2XHU1MzYxXHU3MjQ3XHU5MDA5XHU2MkU5XHJcbiAgICBwcml2YXRlIGhhbmRsZUNhcmRTZWxlY3Rpb24ocGF0aDogc3RyaW5nLCBldmVudDogTW91c2VFdmVudCkge1xyXG4gICAgICAgIGNvbnN0IGNhcmQgPSB0aGlzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKGBbZGF0YS1wYXRoPVwiJHtwYXRofVwiXWApO1xyXG4gICAgICAgIGlmICghY2FyZCkgcmV0dXJuO1xyXG5cclxuICAgICAgICBpZiAoZXZlbnQuY3RybEtleSkge1xyXG4gICAgICAgICAgICAvLyBDdHJsICsgXHU3MEI5XHU1MUZCXHVGRjFBXHU1MjA3XHU2MzYyXHU5MDA5XHU2MkU5XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkTm90ZXMuaGFzKHBhdGgpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkTm90ZXMuZGVsZXRlKHBhdGgpO1xyXG4gICAgICAgICAgICAgICAgY2FyZC5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWROb3Rlcy5hZGQocGF0aCk7XHJcbiAgICAgICAgICAgICAgICBjYXJkLmFkZENsYXNzKCdzZWxlY3RlZCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChldmVudC5zaGlmdEtleSAmJiB0aGlzLmxhc3RTZWxlY3RlZE5vdGUpIHtcclxuICAgICAgICAgICAgLy8gU2hpZnQgKyBcdTcwQjlcdTUxRkJcdUZGMUFcdThGREVcdTdFRURcdTkwMDlcdTYyRTlcclxuICAgICAgICAgICAgY29uc3QgY2FyZHMgPSBBcnJheS5mcm9tKHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5ub3RlLWNhcmQnKSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxhc3RJbmRleCA9IGNhcmRzLmZpbmRJbmRleChjID0+IGMuZ2V0QXR0cmlidXRlKCdkYXRhLXBhdGgnKSA9PT0gdGhpcy5sYXN0U2VsZWN0ZWROb3RlKTtcclxuICAgICAgICAgICAgY29uc3QgY3VycmVudEluZGV4ID0gY2FyZHMuZmluZEluZGV4KGMgPT4gYy5nZXRBdHRyaWJ1dGUoJ2RhdGEtcGF0aCcpID09PSBwYXRoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gTWF0aC5taW4obGFzdEluZGV4LCBjdXJyZW50SW5kZXgpO1xyXG4gICAgICAgICAgICBjb25zdCBlbmQgPSBNYXRoLm1heChsYXN0SW5kZXgsIGN1cnJlbnRJbmRleCk7XHJcblxyXG4gICAgICAgICAgICBjYXJkcy5mb3JFYWNoKChjLCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjYXJkUGF0aCA9IGMuZ2V0QXR0cmlidXRlKCdkYXRhLXBhdGgnKTtcclxuICAgICAgICAgICAgICAgIGlmIChpID49IHN0YXJ0ICYmIGkgPD0gZW5kICYmIGNhcmRQYXRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE5vdGVzLmFkZChjYXJkUGF0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYy5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gXHU2NjZFXHU5MDFBXHU3MEI5XHU1MUZCXHVGRjFBXHU2RTA1XHU5NjY0XHU1MTc2XHU0RUQ2XHU5MDA5XHU2MkU5XHVGRjBDXHU5MDA5XHU0RTJEXHU1RjUzXHU1MjREXHJcbiAgICAgICAgICAgIHRoaXMuY2xlYXJTZWxlY3Rpb24oKTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE5vdGVzLmFkZChwYXRoKTtcclxuICAgICAgICAgICAgY2FyZC5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMubGFzdFNlbGVjdGVkTm90ZSA9IHBhdGg7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gXHU2RTA1XHU5NjY0XHU2MjQwXHU2NzA5XHU5MDA5XHU2MkU5XHJcbiAgICBwcml2YXRlIGNsZWFyU2VsZWN0aW9uKCkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWROb3Rlcy5jbGVhcigpO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5ub3RlLWNhcmQuc2VsZWN0ZWQnKS5mb3JFYWNoKGNhcmQgPT4ge1xyXG4gICAgICAgICAgICBjYXJkLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFx1ODNCN1x1NTNENlx1OTAwOVx1NEUyRFx1NzY4NFx1NjU4N1x1NEVGNlxyXG4gICAgcHJpdmF0ZSBnZXRTZWxlY3RlZEZpbGVzKCk6IFRGaWxlW10ge1xyXG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuc2VsZWN0ZWROb3RlcylcclxuICAgICAgICAgICAgLm1hcChwYXRoID0+IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChwYXRoKSlcclxuICAgICAgICAgICAgLmZpbHRlcigoZmlsZSk6IGZpbGUgaXMgVEZpbGUgPT4gZmlsZSBpbnN0YW5jZW9mIFRGaWxlKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBcdTY2M0VcdTc5M0FcdTUzRjNcdTk1MkVcdTgzRENcdTUzNTVcclxuICAgIHByaXZhdGUgc2hvd0NvbnRleHRNZW51KGV2ZW50OiBNb3VzZUV2ZW50LCBmaWxlczogVEZpbGVbXSkge1xyXG4gICAgICAgIGNvbnN0IG1lbnUgPSBuZXcgTWVudSgpO1xyXG5cclxuICAgICAgICBpZiAoZmlsZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBtZW51LmFkZEl0ZW0oKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgICAgIGl0ZW1cclxuICAgICAgICAgICAgICAgICAgICAuc2V0VGl0bGUoYFx1NTcyOFx1NjVCMFx1NjgwN1x1N0I3RVx1OTg3NVx1NjI1M1x1NUYwMGApXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldEljb24oXCJsaW5rXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZigndGFiJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBsZWFmLm9wZW5GaWxlKGZpbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbWVudS5hZGRJdGVtKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpdGVtXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFRpdGxlKGBcdTU3MjhcdTY1ODdcdTRFRjZcdTdCQTFcdTc0MDZcdTU2NjhcdTRFMkRcdTY2M0VcdTc5M0FgKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRJY29uKFwiZm9sZGVyXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlID0gZmlsZXNbMF07ICAvLyBcdTY2M0VcdTc5M0FcdTdCMkNcdTRFMDBcdTRFMkFcdTkwMDlcdTRFMkRcdTY1ODdcdTRFRjZcdTc2ODRcdTRGNERcdTdGNkVcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXZlYWxGb2xkZXJJbkV4cGxvcmVyKGZpbGUucGFyZW50Py5wYXRoIHx8ICcvJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbWVudS5hZGRJdGVtKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpdGVtXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFRpdGxlKGBcdTc5RkJcdTUyQTggJHtmaWxlcy5sZW5ndGh9IFx1NEUyQVx1NjU4N1x1NEVGNmApXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldEljb24oXCJtb3ZlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2RhbCA9IG5ldyBFbmhhbmNlZEZpbGVTZWxlY3Rpb25Nb2RhbChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY2VudEZvbGRlcnMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZm9sZGVycykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVjZW50Rm9sZGVycyA9IGZvbGRlcnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBtZW51LmFkZEl0ZW0oKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgICAgIGl0ZW1cclxuICAgICAgICAgICAgICAgICAgICAuc2V0VGl0bGUoYFx1NTIyMFx1OTY2NCAke2ZpbGVzLmxlbmd0aH0gXHU0RTJBXHU2NTg3XHU0RUY2YClcclxuICAgICAgICAgICAgICAgICAgICAuc2V0SWNvbihcInRyYXNoXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb25maXJtID0gYXdhaXQgbmV3IENvbmZpcm1Nb2RhbChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJcdTc4NkVcdThCQTRcdTUyMjBcdTk2NjRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBcdTY2MkZcdTU0MjZcdTc4NkVcdTVCOUFcdTg5ODFcdTUyMjBcdTk2NjRcdTkwMDlcdTRFMkRcdTc2ODQgJHtmaWxlcy5sZW5ndGh9IFx1NEUyQVx1NjU4N1x1NEVGNlx1RkYxRmBcclxuICAgICAgICAgICAgICAgICAgICAgICAgKS5zaG93KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlybSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQudHJhc2goZmlsZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2hWaWV3KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBtZW51LnNob3dBdE1vdXNlRXZlbnQoZXZlbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFx1NkRGQlx1NTJBMFx1OEMwM1x1NjU3NFx1NTM2MVx1NzI0N1x1NTkyN1x1NUMwRlx1NzY4NFx1NjVCOVx1NkNENVxyXG4gICAgcHJpdmF0ZSBhZGp1c3RDYXJkU2l6ZShkZWx0YTogbnVtYmVyKSB7XHJcbiAgICAgICAgLy8gXHU2ODM5XHU2MzZFXHU2RURBXHU4RjZFXHU2NUI5XHU1NDExXHU4QzAzXHU2NTc0XHU1OTI3XHU1QzBGXHJcbiAgICAgICAgY29uc3QgYWRqdXN0bWVudCA9IGRlbHRhID4gMCA/IC0xMCA6IDEwO1xyXG4gICAgICAgIGNvbnN0IG5ld1NpemUgPSBNYXRoLm1heChcclxuICAgICAgICAgICAgdGhpcy5NSU5fQ0FSRF9TSVpFLFxyXG4gICAgICAgICAgICBNYXRoLm1pbih0aGlzLk1BWF9DQVJEX1NJWkUsIHRoaXMuY2FyZFNpemUgKyBhZGp1c3RtZW50KVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmIChuZXdTaXplICE9PSB0aGlzLmNhcmRTaXplKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FyZFNpemUgPSBuZXdTaXplO1xyXG4gICAgICAgICAgICAvLyBcdTY2RjRcdTY1QjBcdTYyNDBcdTY3MDlcdTUzNjFcdTcyNDdcdTc2ODRcdTU5MjdcdTVDMEZcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLm5vdGUtY2FyZCcpLmZvckVhY2goKGNhcmQ6IEhUTUxFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjYXJkLnN0eWxlLndpZHRoID0gYCR7dGhpcy5jYXJkU2l6ZX1weGA7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvLyBcdTY2RjRcdTY1QjBcdTdGNTFcdTY4M0NcdTVFMDNcdTVDNDBcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUuZ3JpZFRlbXBsYXRlQ29sdW1ucyA9IGByZXBlYXQoYXV0by1maWxsLCAke3RoaXMuY2FyZFNpemV9cHgpYDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbi8vIFx1NkRGQlx1NTJBMFx1NjU4N1x1NEVGNlx1OTAwOVx1NjJFOVx1NkEyMVx1NjAwMVx1Njg0NlxyXG5jbGFzcyBGaWxlU2VsZWN0aW9uTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XHJcbiAgICBwcml2YXRlIGZpbGU6IFRGaWxlO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBmaWxlOiBURmlsZSkge1xyXG4gICAgICAgIHN1cGVyKGFwcCk7XHJcbiAgICAgICAgdGhpcy5maWxlID0gZmlsZTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBvbk9wZW4oKSB7XHJcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XHJcbiAgICAgICAgY29udGVudEVsLmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ1x1OTAwOVx1NjJFOVx1NzZFRVx1NjgwN1x1NjU4N1x1NEVGNlx1NTkzOScgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGZvbGRlckxpc3QgPSBjb250ZW50RWwuY3JlYXRlRGl2KCdmb2xkZXItbGlzdCcpO1xyXG4gICAgICAgIGNvbnN0IGZvbGRlcnMgPSB0aGlzLmdldEZvbGRlcnMoKTtcclxuXHJcbiAgICAgICAgZm9sZGVycy5mb3JFYWNoKGZvbGRlciA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBmb2xkZXJMaXN0LmNyZWF0ZURpdignZm9sZGVyLWl0ZW0nKTtcclxuICAgICAgICAgICAgaXRlbS5zZXRUZXh0KGZvbGRlcik7XHJcbiAgICAgICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLm1vdmVGaWxlKGZvbGRlcik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Rm9sZGVycygpOiBzdHJpbmdbXSB7XHJcbiAgICAgICAgY29uc3QgZm9sZGVycyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xyXG4gICAgICAgIHRoaXMuYXBwLnZhdWx0LmdldEFsbExvYWRlZEZpbGVzKCkuZm9yRWFjaChmaWxlID0+IHtcclxuICAgICAgICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURm9sZGVyKSB7XHJcbiAgICAgICAgICAgICAgICBmb2xkZXJzLmFkZChmaWxlLnBhdGgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20oZm9sZGVycyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhc3luYyBtb3ZlRmlsZSh0YXJnZXRGb2xkZXI6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IG5ld1BhdGggPSBgJHt0YXJnZXRGb2xkZXJ9LyR7dGhpcy5maWxlLm5hbWV9YDtcclxuICAgICAgICBhd2FpdCB0aGlzLmFwcC5maWxlTWFuYWdlci5yZW5hbWVGaWxlKHRoaXMuZmlsZSwgbmV3UGF0aCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25DbG9zZSgpIHtcclxuICAgICAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcclxuICAgICAgICBjb250ZW50RWwuZW1wdHkoKTtcclxuICAgIH1cclxufVxyXG5cclxuLy8gXHU2REZCXHU1MkEwXHU3ODZFXHU4QkE0XHU1QkY5XHU4QkREXHU2ODQ2XHJcbmNsYXNzIENvbmZpcm1Nb2RhbCBleHRlbmRzIE1vZGFsIHtcclxuICAgIHByaXZhdGUgcmVzdWx0OiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIHJlc29sdmVQcm9taXNlOiAodmFsdWU6IGJvb2xlYW4pID0+IHZvaWQ7XHJcbiAgICBwcml2YXRlIHRpdGxlOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIG1lc3NhZ2U6IHN0cmluZztcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgdGl0bGU6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nKSB7XHJcbiAgICAgICAgc3VwZXIoYXBwKTtcclxuICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBzaG93KCk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJlc29sdmVQcm9taXNlID0gcmVzb2x2ZTtcclxuICAgICAgICAgICAgdGhpcy5vcGVuKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgb25PcGVuKCkge1xyXG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xyXG4gICAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgnaDMnLCB7IHRleHQ6IHRoaXMudGl0bGUgfSk7XHJcbiAgICAgICAgY29udGVudEVsLmNyZWF0ZUVsKCdwJywgeyB0ZXh0OiB0aGlzLm1lc3NhZ2UgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGJ1dHRvbkNvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoJ2J1dHRvbi1jb250YWluZXInKTtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBjb25maXJtQnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKCdidXR0b24nLCB7IHRleHQ6ICdcdTc4NkVcdThCQTQnIH0pO1xyXG4gICAgICAgIGNvbmZpcm1CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucmVzdWx0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBjYW5jZWxCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoJ2J1dHRvbicsIHsgdGV4dDogJ1x1NTNENlx1NkQ4OCcgfSk7XHJcbiAgICAgICAgY2FuY2VsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJlc3VsdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgb25DbG9zZSgpIHtcclxuICAgICAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcclxuICAgICAgICBjb250ZW50RWwuZW1wdHkoKTtcclxuICAgICAgICB0aGlzLnJlc29sdmVQcm9taXNlKHRoaXMucmVzdWx0KTtcclxuICAgIH1cclxufVxyXG5cclxuLy8gXHU0RkVFXHU2NTM5XHU1ODlFXHU1RjNBXHU3Njg0XHU2NTg3XHU0RUY2XHU5MDA5XHU2MkU5XHU2QTIxXHU2MDAxXHU2ODQ2XHJcbmNsYXNzIEVuaGFuY2VkRmlsZVNlbGVjdGlvbk1vZGFsIGV4dGVuZHMgTW9kYWwge1xyXG4gICAgcHJpdmF0ZSBmaWxlczogVEZpbGVbXTtcclxuICAgIHByaXZhdGUgcmVjZW50Rm9sZGVyczogc3RyaW5nW107XHJcbiAgICBwcml2YXRlIG9uRm9sZGVyc1VwZGF0ZTogKGZvbGRlcnM6IHN0cmluZ1tdKSA9PiB2b2lkO1xyXG4gICAgcHJpdmF0ZSBzZWxlY3RlZEZvbGRlcjogc3RyaW5nIHwgbnVsbCA9IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgYXBwOiBBcHAsXHJcbiAgICAgICAgZmlsZXM6IFRGaWxlW10sXHJcbiAgICAgICAgcmVjZW50Rm9sZGVyczogc3RyaW5nW10sXHJcbiAgICAgICAgb25Gb2xkZXJzVXBkYXRlOiAoZm9sZGVyczogc3RyaW5nW10pID0+IHZvaWRcclxuICAgICkge1xyXG4gICAgICAgIHN1cGVyKGFwcCk7XHJcbiAgICAgICAgdGhpcy5maWxlcyA9IGZpbGVzO1xyXG4gICAgICAgIHRoaXMucmVjZW50Rm9sZGVycyA9IHJlY2VudEZvbGRlcnM7XHJcbiAgICAgICAgdGhpcy5vbkZvbGRlcnNVcGRhdGUgPSBvbkZvbGRlcnNVcGRhdGU7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgb25PcGVuKCkge1xyXG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xyXG4gICAgICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xyXG5cclxuICAgICAgICAvLyBcdTY4MDdcdTk4OThcclxuICAgICAgICBjb250ZW50RWwuY3JlYXRlRWwoJ2gzJywgeyBcclxuICAgICAgICAgICAgdGV4dDogYFx1NzlGQlx1NTJBOCAke3RoaXMuZmlsZXMubGVuZ3RofSBcdTRFMkFcdTY1ODdcdTRFRjZgIFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBcdTY3MDBcdThGRDFcdTRGN0ZcdTc1MjhcdTc2ODRcdTY1ODdcdTRFRjZcdTU5MzlcclxuICAgICAgICBpZiAodGhpcy5yZWNlbnRGb2xkZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc3QgcmVjZW50U2VjdGlvbiA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoJ3JlY2VudC1mb2xkZXJzLXNlY3Rpb24nKTtcclxuICAgICAgICAgICAgcmVjZW50U2VjdGlvbi5jcmVhdGVFbCgnaDQnLCB7IHRleHQ6ICdcdTY3MDBcdThGRDFcdTRGN0ZcdTc1MjgnIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVjZW50TGlzdCA9IHJlY2VudFNlY3Rpb24uY3JlYXRlRGl2KCdyZWNlbnQtZm9sZGVycy1saXN0Jyk7XHJcbiAgICAgICAgICAgIHRoaXMucmVjZW50Rm9sZGVycy5mb3JFYWNoKGZvbGRlciA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gcmVjZW50TGlzdC5jcmVhdGVEaXYoJ2ZvbGRlci1pdGVtIHJlY2VudCcpO1xyXG4gICAgICAgICAgICAgICAgaXRlbS5zZXRUZXh0KGZvbGRlcik7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5zZWxlY3RGb2xkZXIoaXRlbSwgZm9sZGVyKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gXHU2MjQwXHU2NzA5XHU2NTg3XHU0RUY2XHU1OTM5XHU1MjE3XHU4ODY4XHJcbiAgICAgICAgY29uc3QgZm9sZGVyTGlzdCA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoJ2ZvbGRlci1saXN0Jyk7XHJcbiAgICAgICAgY29uc3QgZm9sZGVycyA9IHRoaXMuZ2V0Rm9sZGVyc1dpdGhIaWVyYXJjaHkoKTtcclxuICAgICAgICB0aGlzLmNyZWF0ZUZvbGRlclRyZWUoZm9sZGVyTGlzdCwgZm9sZGVycyk7XHJcblxyXG4gICAgICAgIC8vIFx1NkRGQlx1NTJBMFx1NjRDRFx1NEY1Q1x1NjMwOVx1OTRBRVxyXG4gICAgICAgIGNvbnN0IGJ1dHRvbkNvbnRhaW5lciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoJ21vZGFsLWJ1dHRvbi1jb250YWluZXInKTtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBjb25maXJtQnV0dG9uID0gYnV0dG9uQ29udGFpbmVyLmNyZWF0ZUVsKCdidXR0b24nLCB7XHJcbiAgICAgICAgICAgIHRleHQ6ICdcdTc4NkVcdThCQTRcdTc5RkJcdTUyQTgnLFxyXG4gICAgICAgICAgICBjbHM6ICdtb2QtY3RhJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbmZpcm1CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkRm9sZGVyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1vdmVGaWxlcyh0aGlzLnNlbGVjdGVkRm9sZGVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBjYW5jZWxCdXR0b24gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoJ2J1dHRvbicsIHtcclxuICAgICAgICAgICAgdGV4dDogJ1x1NTNENlx1NkQ4OCdcclxuICAgICAgICB9KTtcclxuICAgICAgICBjYW5jZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLmNsb3NlKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Rm9sZGVyc1dpdGhIaWVyYXJjaHkoKTogRm9sZGVySXRlbVtdIHtcclxuICAgICAgICBjb25zdCBmb2xkZXJzOiBGb2xkZXJJdGVtW10gPSBbXTtcclxuICAgICAgICBjb25zdCBzZWVuID0gbmV3IFNldDxzdHJpbmc+KCk7XHJcblxyXG4gICAgICAgIHRoaXMuYXBwLnZhdWx0LmdldEFsbExvYWRlZEZpbGVzKCkuZm9yRWFjaChmaWxlID0+IHtcclxuICAgICAgICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURm9sZGVyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IGZpbGUucGF0aC5zcGxpdCgnLycpO1xyXG4gICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRQYXRoID0gJyc7XHJcbiAgICAgICAgICAgICAgICBsZXQgbGV2ZWwgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgIHBhcnRzLmZvckVhY2gocGFydCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBhdGggKz0gKGN1cnJlbnRQYXRoID8gJy8nIDogJycpICsgcGFydDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzZWVuLmhhcyhjdXJyZW50UGF0aCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlZW4uYWRkKGN1cnJlbnRQYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbGRlcnMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogY3VycmVudFBhdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcGFydCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXZlbDogbGV2ZWxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsKys7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGZvbGRlcnMuc29ydCgoYSwgYikgPT4gYS5wYXRoLmxvY2FsZUNvbXBhcmUoYi5wYXRoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjcmVhdGVGb2xkZXJUcmVlKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIGZvbGRlcnM6IEZvbGRlckl0ZW1bXSkge1xyXG4gICAgICAgIGZvbGRlcnMuZm9yRWFjaChmb2xkZXIgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtID0gY29udGFpbmVyLmNyZWF0ZURpdih7XHJcbiAgICAgICAgICAgICAgICBjbHM6ICdmb2xkZXItaXRlbSdcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBcdTZERkJcdTUyQTBcdTdGMjlcdThGREJcclxuICAgICAgICAgICAgaXRlbS5zdHlsZS5wYWRkaW5nTGVmdCA9IGAke2ZvbGRlci5sZXZlbCAqIDIwICsgMTB9cHhgO1xyXG5cclxuICAgICAgICAgICAgLy8gXHU2REZCXHU1MkEwXHU2NTg3XHU0RUY2XHU1OTM5XHU1NkZFXHU2ODA3XHJcbiAgICAgICAgICAgIGNvbnN0IGljb24gPSBpdGVtLmNyZWF0ZVNwYW4oe1xyXG4gICAgICAgICAgICAgICAgY2xzOiAnZm9sZGVyLWljb24nXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpY29uLmlubmVySFRNTCA9IGA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB3aWR0aD1cIjE2XCIgaGVpZ2h0PVwiMTZcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgZmlsbD1cIm5vbmVcIiBzdHJva2U9XCJjdXJyZW50Q29sb3JcIiBzdHJva2Utd2lkdGg9XCIyXCIgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZS1saW5lam9pbj1cInJvdW5kXCI+PHBhdGggZD1cIk0yMiAxOWEyIDIgMCAwIDEtMiAySDRhMiAyIDAgMCAxLTItMlY1YTIgMiAwIDAgMSAyLTJoNWwyIDNoOWEyIDIgMCAwIDEgMiAyelwiPjwvcGF0aD48L3N2Zz5gO1xyXG5cclxuICAgICAgICAgICAgLy8gXHU2REZCXHU1MkEwXHU2NTg3XHU0RUY2XHU1OTM5XHU1NDBEXHU3OUYwXHJcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBpdGVtLmNyZWF0ZVNwYW4oe1xyXG4gICAgICAgICAgICAgICAgY2xzOiAnZm9sZGVyLW5hbWUnLFxyXG4gICAgICAgICAgICAgICAgdGV4dDogZm9sZGVyLm5hbWVcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5zZWxlY3RGb2xkZXIoaXRlbSwgZm9sZGVyLnBhdGgpKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNlbGVjdEZvbGRlcihlbGVtZW50OiBIVE1MRWxlbWVudCwgcGF0aDogc3RyaW5nKSB7XHJcbiAgICAgICAgLy8gXHU3OUZCXHU5NjY0XHU1MTc2XHU0RUQ2XHU5MDA5XHU0RTJEXHU3MkI2XHU2MDAxXHJcbiAgICAgICAgdGhpcy5jb250ZW50RWwucXVlcnlTZWxlY3RvckFsbCgnLmZvbGRlci1pdGVtJykuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgaXRlbS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gXHU2REZCXHU1MkEwXHU5MDA5XHU0RTJEXHU3MkI2XHU2MDAxXHJcbiAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcclxuICAgICAgICB0aGlzLnNlbGVjdGVkRm9sZGVyID0gcGF0aDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFzeW5jIG1vdmVGaWxlcyh0YXJnZXRGb2xkZXI6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IGNvbmZpcm1Nb2RhbCA9IG5ldyBDb25maXJtTW9kYWwoXHJcbiAgICAgICAgICAgIHRoaXMuYXBwLFxyXG4gICAgICAgICAgICBcIlx1Nzg2RVx1OEJBNFx1NzlGQlx1NTJBOFwiLFxyXG4gICAgICAgICAgICBgXHU2NjJGXHU1NDI2XHU1QzA2XHU5MDA5XHU0RTJEXHU3Njg0ICR7dGhpcy5maWxlcy5sZW5ndGh9IFx1NEUyQVx1NjU4N1x1NEVGNlx1NzlGQlx1NTJBOFx1NTIzMCBcIiR7dGFyZ2V0Rm9sZGVyfVwiXHVGRjFGYFxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmIChhd2FpdCBjb25maXJtTW9kYWwuc2hvdygpKSB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgZmlsZSBvZiB0aGlzLmZpbGVzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdQYXRoID0gYCR7dGFyZ2V0Rm9sZGVyfS8ke2ZpbGUubmFtZX1gO1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHAuZmlsZU1hbmFnZXIucmVuYW1lRmlsZShmaWxlLCBuZXdQYXRoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gXHU2NkY0XHU2NUIwXHU2NzAwXHU4RkQxXHU0RjdGXHU3NTI4XHU3Njg0XHU2NTg3XHU0RUY2XHU1OTM5XHJcbiAgICAgICAgICAgIHRoaXMucmVjZW50Rm9sZGVycyA9IFt0YXJnZXRGb2xkZXIsIC4uLnRoaXMucmVjZW50Rm9sZGVycy5maWx0ZXIoZiA9PiBmICE9PSB0YXJnZXRGb2xkZXIpXVxyXG4gICAgICAgICAgICAgICAgLnNsaWNlKDAsIDUpO1xyXG4gICAgICAgICAgICB0aGlzLm9uRm9sZGVyc1VwZGF0ZSh0aGlzLnJlY2VudEZvbGRlcnMpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuLy8gXHU2REZCXHU1MkEwXHU2NTg3XHU0RUY2XHU1OTM5XHU5ODc5XHU2M0E1XHU1M0UzXHJcbmludGVyZmFjZSBGb2xkZXJJdGVtIHtcclxuICAgIHBhdGg6IHN0cmluZztcclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIGxldmVsOiBudW1iZXI7XHJcbn0gIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUEsdUJBQTZFOzs7QUNBN0Usc0JBVU87QUFHQSxJQUFNLGlCQUFpQjtBQUV2Qiw2QkFBdUIseUJBQVM7QUFBQSxFQXlCbkMsWUFBWSxNQUFxQixRQUF3QjtBQUNyRCxVQUFNO0FBbEJGLDhCQUE4QjtBQUM5Qix5QkFBK0I7QUFFL0IsNkJBQTRCO0FBQzVCLHdCQUE0QixJQUFJO0FBQ2hDLHlCQUE2QixJQUFJO0FBQ2pDLDRCQUFrQztBQUNsQyx5QkFBMEI7QUFDMUIsb0JBQW1CO0FBQ1YseUJBQWdCO0FBQ2hCLHlCQUFnQjtBQVM3QixTQUFLLFNBQVM7QUFDZCxTQUFLLGNBQWMsT0FBTyxTQUFTO0FBQUE7QUFBQSxFQU92QyxjQUFzQjtBQUNsQixXQUFPO0FBQUE7QUFBQSxFQU9YLGlCQUF5QjtBQUNyQixXQUFPO0FBQUE7QUFBQSxRQU9MLFNBQVM7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
