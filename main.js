/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __markAsModule = (target) => __defProp(target, "__esModule", { value: true });
var __export = (target, all) => {
  __markAsModule(target);
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __reExport = (target, module2, desc) => {
  if (module2 && typeof module2 === "object" || typeof module2 === "function") {
    for (let key of __getOwnPropNames(module2))
      if (!__hasOwnProp.call(target, key) && key !== "default")
        __defProp(target, key, { get: () => module2[key], enumerable: !(desc = __getOwnPropDesc(module2, key)) || desc.enumerable });
  }
  return target;
};
var __toModule = (module2) => {
  return __reExport(__markAsModule(__defProp(module2 != null ? __create(__getProtoOf(module2)) : {}, "default", module2 && module2.__esModule && "default" in module2 ? { get: () => module2.default, enumerable: true } : { value: module2, enumerable: true })), module2);
};

// main.ts
__export(exports, {
  default: () => CardViewPlugin
});
var import_obsidian2 = __toModule(require("obsidian"));

// cardView.ts
var import_obsidian = __toModule(require("obsidian"));
var VIEW_TYPE_CARD = "card-view";
var CardView = class extends import_obsidian.ItemView {
  constructor(leaf, plugin) {
    super(leaf);
    this.plugin = plugin;
    this.currentView = plugin.settings.defaultView;
  }
  getViewType() {
    return VIEW_TYPE_CARD;
  }
  getDisplayText() {
    return "\u5361\u7247\u89C6\u56FE";
  }
  async onOpen() {
    const { containerEl } = this;
    this.tagContainer = containerEl.createDiv("tag-filter");
    await this.loadTags();
    const viewSwitcher = containerEl.createDiv("view-switcher");
    this.createViewSwitcher(viewSwitcher);
    this.container = containerEl.createDiv("card-container");
    this.previewContainer = containerEl.createDiv("preview-container");
    await this.loadNotes();
  }
  async loadTags() {
    const tags = this.getAllTags();
    tags.forEach((tag) => {
      const tagEl = this.tagContainer.createEl("button", { text: tag });
      tagEl.addEventListener("click", () => this.filterByTag(tag));
    });
  }
  getAllTags() {
    const tags = new Set();
    this.app.vault.getMarkdownFiles().forEach((file) => {
      const cache = this.app.metadataCache.getFileCache(file);
      if (cache == null ? void 0 : cache.tags) {
        cache.tags.forEach((tag) => tags.add(tag.tag));
      }
    });
    return Array.from(tags);
  }
  createViewSwitcher(container) {
    const views = ["card", "list", "timeline"];
    views.forEach((view) => {
      const btn = container.createEl("button", { text: view });
      btn.addEventListener("click", () => this.switchView(view));
    });
  }
  async loadNotes() {
    const files = this.app.vault.getMarkdownFiles();
    this.container.empty();
    files.forEach((file) => {
      const card = this.createNoteCard(file);
      this.container.appendChild(card);
    });
  }
  createNoteCard(file) {
    const card = document.createElement("div");
    card.addClass("note-card");
    const title = card.createDiv("note-title");
    title.setText(file.basename);
    const lastModified = card.createDiv("note-date");
    lastModified.setText(new Date(file.stat.mtime).toLocaleDateString());
    const cache = this.app.metadataCache.getFileCache(file);
    if (cache == null ? void 0 : cache.tags) {
      const tagContainer = card.createDiv("note-tags");
      cache.tags.forEach((tag) => {
        const tagEl = tagContainer.createEl("span", {
          text: tag.tag,
          cls: "note-tag"
        });
      });
    }
    card.addEventListener("mouseenter", async () => {
      try {
        this.previewContainer.empty();
        const content = await this.app.vault.read(file);
        await import_obsidian.MarkdownRenderer.renderMarkdown(content, this.previewContainer, file.path, this);
      } catch (error) {
        console.error("\u9884\u89C8\u52A0\u8F7D\u5931\u8D25:", error);
        this.previewContainer.setText("\u9884\u89C8\u52A0\u8F7D\u5931\u8D25");
      }
    });
    return card;
  }
  switchView(view) {
    this.currentView = view;
    this.container.setAttribute("data-view", view);
    this.loadNotes();
  }
  filterByTag(tag) {
    const files = this.app.vault.getMarkdownFiles();
    this.container.empty();
    files.forEach((file) => {
      const cache = this.app.metadataCache.getFileCache(file);
      if ((cache == null ? void 0 : cache.tags) && cache.tags.some((t) => t.tag === tag)) {
        const card = this.createNoteCard(file);
        this.container.appendChild(card);
      }
    });
    this.tagContainer.querySelectorAll("button").forEach((btn) => {
      if (btn.textContent === tag) {
        btn.addClass("active-tag");
      } else {
        btn.removeClass("active-tag");
      }
    });
  }
};

// main.ts
var DEFAULT_SETTINGS = {
  defaultView: "card"
};
var CardViewSettingTab = class extends import_obsidian2.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian2.Setting(containerEl).setName("\u9ED8\u8BA4\u89C6\u56FE").setDesc("\u9009\u62E9\u9ED8\u8BA4\u7684\u89C6\u56FE\u6A21\u5F0F").addDropdown((dropdown) => dropdown.addOption("card", "\u5361\u7247\u89C6\u56FE1").addOption("list", "\u5217\u8868\u89C6\u56FE").addOption("timeline", "\u65F6\u95F4\u8F74\u89C6\u56FE").setValue(this.plugin.settings.defaultView).onChange(async (value) => {
      this.plugin.settings.defaultView = value;
      await this.plugin.saveSettings();
    }));
  }
};
var CardViewPlugin = class extends import_obsidian2.Plugin {
  async onload() {
    await this.loadSettings();
    this.registerView(VIEW_TYPE_CARD, (leaf) => new CardView(leaf, this));
    this.addRibbonIcon("layout-grid", "\u5361\u7247\u89C6\u56FE", () => {
      this.activateView();
    });
    this.addSettingTab(new CardViewSettingTab(this.app, this));
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  async activateView() {
    const { workspace } = this.app;
    let leaf = workspace.getLeavesOfType(VIEW_TYPE_CARD)[0];
    if (!leaf) {
      leaf = workspace.getLeaf("tab");
      await leaf.setViewState({
        type: VIEW_TYPE_CARD,
        active: true
      });
    }
    workspace.revealLeaf(leaf);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJjYXJkVmlldy50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBQbHVnaW4sIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcsIFRGaWxlLCBXb3Jrc3BhY2VMZWFmIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgeyBDYXJkVmlldywgVklFV19UWVBFX0NBUkQgfSBmcm9tICcuL2NhcmRWaWV3JztcclxuXHJcbmludGVyZmFjZSBDYXJkVmlld1BsdWdpblNldHRpbmdzIHtcclxuICAgIGRlZmF1bHRWaWV3OiAnY2FyZCcgfCAnbGlzdCcgfCAndGltZWxpbmUnO1xyXG59XHJcblxyXG5jb25zdCBERUZBVUxUX1NFVFRJTkdTOiBDYXJkVmlld1BsdWdpblNldHRpbmdzID0ge1xyXG4gICAgZGVmYXVsdFZpZXc6ICdjYXJkJ1xyXG59XHJcblxyXG4vLyBcdTZERkJcdTUyQTBcdThCQkVcdTdGNkVcdTkwMDlcdTk4NzlcdTUzNjFcdTdDN0JcclxuY2xhc3MgQ2FyZFZpZXdTZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XHJcbiAgICBwbHVnaW46IENhcmRWaWV3UGx1Z2luO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IENhcmRWaWV3UGx1Z2luKSB7XHJcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xyXG4gICAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xyXG4gICAgfVxyXG5cclxuICAgIGRpc3BsYXkoKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpcztcclxuICAgICAgICBjb250YWluZXJFbC5lbXB0eSgpO1xyXG5cclxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAgICAgLnNldE5hbWUoJ1x1OUVEOFx1OEJBNFx1ODlDNlx1NTZGRScpXHJcbiAgICAgICAgICAgIC5zZXREZXNjKCdcdTkwMDlcdTYyRTlcdTlFRDhcdThCQTRcdTc2ODRcdTg5QzZcdTU2RkVcdTZBMjFcdTVGMEYnKVxyXG4gICAgICAgICAgICAuYWRkRHJvcGRvd24oZHJvcGRvd24gPT4gXHJcbiAgICAgICAgICAgICAgICBkcm9wZG93blxyXG4gICAgICAgICAgICAgICAgICAgIC5hZGRPcHRpb24oJ2NhcmQnLCAnXHU1MzYxXHU3MjQ3XHU4OUM2XHU1NkZFMScpXHJcbiAgICAgICAgICAgICAgICAgICAgLmFkZE9wdGlvbignbGlzdCcsICdcdTUyMTdcdTg4NjhcdTg5QzZcdTU2RkUnKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hZGRPcHRpb24oJ3RpbWVsaW5lJywgJ1x1NjVGNlx1OTVGNFx1OEY3NFx1ODlDNlx1NTZGRScpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmRlZmF1bHRWaWV3KVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWU6ICdjYXJkJyB8ICdsaXN0JyB8ICd0aW1lbGluZScpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZGVmYXVsdFZpZXcgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZFZpZXdQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xyXG4gICAgc2V0dGluZ3M6IENhcmRWaWV3UGx1Z2luU2V0dGluZ3M7XHJcblxyXG4gICAgYXN5bmMgb25sb2FkKCkge1xyXG4gICAgICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XHJcblxyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJWaWV3KFxyXG4gICAgICAgICAgICBWSUVXX1RZUEVfQ0FSRCxcclxuICAgICAgICAgICAgKGxlYWY6IFdvcmtzcGFjZUxlYWYpID0+IG5ldyBDYXJkVmlldyhsZWFmLCB0aGlzKVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkUmliYm9uSWNvbignbGF5b3V0LWdyaWQnLCAnXHU1MzYxXHU3MjQ3XHU4OUM2XHU1NkZFJywgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmFjdGl2YXRlVmlldygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IENhcmRWaWV3U2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcclxuICAgICAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBhY3RpdmF0ZVZpZXcoKSB7XHJcbiAgICAgICAgY29uc3QgeyB3b3Jrc3BhY2UgfSA9IHRoaXMuYXBwO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGxldCBsZWFmID0gd29ya3NwYWNlLmdldExlYXZlc09mVHlwZShWSUVXX1RZUEVfQ0FSRClbMF07XHJcbiAgICAgICAgaWYgKCFsZWFmKSB7XHJcbiAgICAgICAgICAgIC8vIFx1NEZFRVx1NjUzOVx1OEZEOVx1OTFDQ1x1RkYwQ1x1NEY3Rlx1NzUyOCBnZXRMZWFmIFx1NTIxQlx1NUVGQVx1NjVCMFx1NjgwN1x1N0I3RVx1OTg3NVxyXG4gICAgICAgICAgICBsZWFmID0gd29ya3NwYWNlLmdldExlYWYoJ3RhYicpO1xyXG4gICAgICAgICAgICBhd2FpdCBsZWFmLnNldFZpZXdTdGF0ZSh7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBWSUVXX1RZUEVfQ0FSRCxcclxuICAgICAgICAgICAgICAgIGFjdGl2ZTogdHJ1ZSxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHdvcmtzcGFjZS5yZXZlYWxMZWFmKGxlYWYpO1xyXG4gICAgfVxyXG59ICIsICJpbXBvcnQgeyBJdGVtVmlldywgV29ya3NwYWNlTGVhZiwgVEZpbGUsIE1hcmtkb3duUmVuZGVyZXIgfSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCBDYXJkVmlld1BsdWdpbiBmcm9tICcuL21haW4nO1xyXG5cclxuZXhwb3J0IGNvbnN0IFZJRVdfVFlQRV9DQVJEID0gJ2NhcmQtdmlldyc7XHJcblxyXG5leHBvcnQgY2xhc3MgQ2FyZFZpZXcgZXh0ZW5kcyBJdGVtVmlldyB7XHJcbiAgICBwcml2YXRlIHBsdWdpbjogQ2FyZFZpZXdQbHVnaW47XHJcbiAgICBwcml2YXRlIGN1cnJlbnRWaWV3OiAnY2FyZCcgfCAnbGlzdCcgfCAndGltZWxpbmUnO1xyXG4gICAgcHJpdmF0ZSBjb250YWluZXI6IEhUTUxFbGVtZW50O1xyXG4gICAgcHJpdmF0ZSB0YWdDb250YWluZXI6IEhUTUxFbGVtZW50O1xyXG4gICAgcHJpdmF0ZSBjb250ZW50Q29udGFpbmVyOiBIVE1MRWxlbWVudDtcclxuICAgIHByaXZhdGUgcHJldmlld0NvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcdTY3ODRcdTkwMjBcdTUxRkRcdTY1NzBcclxuICAgICAqIEBwYXJhbSBsZWFmIC0gXHU1REU1XHU0RjVDXHU1MzNBXHU1M0Y2XHU1QjUwXHU4MjgyXHU3MEI5XHJcbiAgICAgKiBAcGFyYW0gcGx1Z2luIC0gXHU2M0QyXHU0RUY2XHU1QjlFXHU0RjhCXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKGxlYWY6IFdvcmtzcGFjZUxlYWYsIHBsdWdpbjogQ2FyZFZpZXdQbHVnaW4pIHtcclxuICAgICAgICBzdXBlcihsZWFmKTtcclxuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICAgICAgICB0aGlzLmN1cnJlbnRWaWV3ID0gcGx1Z2luLnNldHRpbmdzLmRlZmF1bHRWaWV3O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHU4M0I3XHU1M0Q2XHU4OUM2XHU1NkZFXHU3QzdCXHU1NzhCXHJcbiAgICAgKiBAcmV0dXJucyBcdTg5QzZcdTU2RkVcdTdDN0JcdTU3OEJcdTY4MDdcdThCQzZcdTdCMjZcclxuICAgICAqL1xyXG4gICAgZ2V0Vmlld1R5cGUoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gVklFV19UWVBFX0NBUkQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcdTgzQjdcdTUzRDZcdTg5QzZcdTU2RkVcdTY2M0VcdTc5M0FcdTY1ODdcdTY3MkNcclxuICAgICAqIEByZXR1cm5zIFx1NjYzRVx1NzkzQVx1NTcyOFx1NjgwN1x1N0I3RVx1OTg3NVx1NEUwQVx1NzY4NFx1NjU4N1x1NjcyQ1xyXG4gICAgICovXHJcbiAgICBnZXREaXNwbGF5VGV4dCgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiAnXHU1MzYxXHU3MjQ3XHU4OUM2XHU1NkZFJztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFx1ODlDNlx1NTZGRVx1NjI1M1x1NUYwMFx1NjVGNlx1NzY4NFx1NTIxRFx1NTlDQlx1NTMxNlx1NTFGRFx1NjU3MFxyXG4gICAgICogXHU1MjFCXHU1RUZBXHU2ODA3XHU3QjdFXHU4RkM3XHU2RUU0XHU1NjY4XHUzMDAxXHU4OUM2XHU1NkZFXHU1MjA3XHU2MzYyXHU2MzA5XHU5NEFFXHU1NDhDXHU1QkI5XHU1NjY4XHJcbiAgICAgKi9cclxuICAgIGFzeW5jIG9uT3BlbigpIHtcclxuICAgICAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMudGFnQ29udGFpbmVyID0gY29udGFpbmVyRWwuY3JlYXRlRGl2KCd0YWctZmlsdGVyJyk7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkVGFncygpO1xyXG5cclxuICAgICAgICBjb25zdCB2aWV3U3dpdGNoZXIgPSBjb250YWluZXJFbC5jcmVhdGVEaXYoJ3ZpZXctc3dpdGNoZXInKTtcclxuICAgICAgICB0aGlzLmNyZWF0ZVZpZXdTd2l0Y2hlcih2aWV3U3dpdGNoZXIpO1xyXG5cclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdignY2FyZC1jb250YWluZXInKTtcclxuICAgICAgICB0aGlzLnByZXZpZXdDb250YWluZXIgPSBjb250YWluZXJFbC5jcmVhdGVEaXYoJ3ByZXZpZXctY29udGFpbmVyJyk7XHJcblxyXG4gICAgICAgIGF3YWl0IHRoaXMubG9hZE5vdGVzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcdTUyQTBcdThGN0RcdTYyNDBcdTY3MDlcdTY4MDdcdTdCN0VcdTVFNzZcdTUyMUJcdTVFRkFcdTY4MDdcdTdCN0VcdThGQzdcdTZFRTRcdTU2NjhcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBhc3luYyBsb2FkVGFncygpIHtcclxuICAgICAgICBjb25zdCB0YWdzID0gdGhpcy5nZXRBbGxUYWdzKCk7XHJcbiAgICAgICAgdGFncy5mb3JFYWNoKHRhZyA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhZ0VsID0gdGhpcy50YWdDb250YWluZXIuY3JlYXRlRWwoJ2J1dHRvbicsIHsgdGV4dDogdGFnIH0pO1xyXG4gICAgICAgICAgICB0YWdFbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMuZmlsdGVyQnlUYWcodGFnKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcdTgzQjdcdTUzRDZcdTYyNDBcdTY3MDlcdTdCMTRcdThCQjBcdTRFMkRcdTc2ODRcdTY4MDdcdTdCN0VcclxuICAgICAqIEByZXR1cm5zIFx1NTNCQlx1OTFDRFx1NTQwRVx1NzY4NFx1NjgwN1x1N0I3RVx1NjU3MFx1N0VDNFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldEFsbFRhZ3MoKTogc3RyaW5nW10ge1xyXG4gICAgICAgIGNvbnN0IHRhZ3MgPSBuZXcgU2V0PHN0cmluZz4oKTtcclxuICAgICAgICB0aGlzLmFwcC52YXVsdC5nZXRNYXJrZG93bkZpbGVzKCkuZm9yRWFjaChmaWxlID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY2FjaGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKTtcclxuICAgICAgICAgICAgaWYgKGNhY2hlPy50YWdzKSB7XHJcbiAgICAgICAgICAgICAgICBjYWNoZS50YWdzLmZvckVhY2godGFnID0+IHRhZ3MuYWRkKHRhZy50YWcpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRhZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHU1MjFCXHU1RUZBXHU4OUM2XHU1NkZFXHU1MjA3XHU2MzYyXHU2MzA5XHU5NEFFXHJcbiAgICAgKiBAcGFyYW0gY29udGFpbmVyIC0gXHU2MzA5XHU5NEFFXHU1QkI5XHU1NjY4XHU1MTQzXHU3RDIwXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgY3JlYXRlVmlld1N3aXRjaGVyKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICBjb25zdCB2aWV3cyA9IFsnY2FyZCcsICdsaXN0JywgJ3RpbWVsaW5lJ107XHJcbiAgICAgICAgdmlld3MuZm9yRWFjaCh2aWV3ID0+IHtcclxuICAgICAgICAgICAgY29uc3QgYnRuID0gY29udGFpbmVyLmNyZWF0ZUVsKCdidXR0b24nLCB7IHRleHQ6IHZpZXcgfSk7XHJcbiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMuc3dpdGNoVmlldyh2aWV3IGFzIGFueSkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHU1MkEwXHU4RjdEXHU2MjQwXHU2NzA5XHU3QjE0XHU4QkIwXHU1RTc2XHU1MjFCXHU1RUZBXHU1MzYxXHU3MjQ3XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgYXN5bmMgbG9hZE5vdGVzKCkge1xyXG4gICAgICAgIGNvbnN0IGZpbGVzID0gdGhpcy5hcHAudmF1bHQuZ2V0TWFya2Rvd25GaWxlcygpO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLmVtcHR5KCk7XHJcblxyXG4gICAgICAgIGZpbGVzLmZvckVhY2goZmlsZSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhcmQgPSB0aGlzLmNyZWF0ZU5vdGVDYXJkKGZpbGUpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZChjYXJkKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFx1NTIxQlx1NUVGQVx1NTM1NVx1NEUyQVx1N0IxNFx1OEJCMFx1NTM2MVx1NzI0N1xyXG4gICAgICogQHBhcmFtIGZpbGUgLSBcdTdCMTRcdThCQjBcdTY1ODdcdTRFRjZcclxuICAgICAqIEByZXR1cm5zIFx1NTM2MVx1NzI0N0hUTUxcdTUxNDNcdTdEMjBcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBjcmVhdGVOb3RlQ2FyZChmaWxlOiBURmlsZSk6IEhUTUxFbGVtZW50IHtcclxuICAgICAgICBjb25zdCBjYXJkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgY2FyZC5hZGRDbGFzcygnbm90ZS1jYXJkJyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgdGl0bGUgPSBjYXJkLmNyZWF0ZURpdignbm90ZS10aXRsZScpO1xyXG4gICAgICAgIHRpdGxlLnNldFRleHQoZmlsZS5iYXNlbmFtZSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGxhc3RNb2RpZmllZCA9IGNhcmQuY3JlYXRlRGl2KCdub3RlLWRhdGUnKTtcclxuICAgICAgICBsYXN0TW9kaWZpZWQuc2V0VGV4dChuZXcgRGF0ZShmaWxlLnN0YXQubXRpbWUpLnRvTG9jYWxlRGF0ZVN0cmluZygpKTtcclxuXHJcbiAgICAgICAgY29uc3QgY2FjaGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKTtcclxuICAgICAgICBpZiAoY2FjaGU/LnRhZ3MpIHtcclxuICAgICAgICAgICAgY29uc3QgdGFnQ29udGFpbmVyID0gY2FyZC5jcmVhdGVEaXYoJ25vdGUtdGFncycpO1xyXG4gICAgICAgICAgICBjYWNoZS50YWdzLmZvckVhY2godGFnID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRhZ0VsID0gdGFnQ29udGFpbmVyLmNyZWF0ZUVsKCdzcGFuJywge1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRhZy50YWcsXHJcbiAgICAgICAgICAgICAgICAgICAgY2xzOiAnbm90ZS10YWcnXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnByZXZpZXdDb250YWluZXIuZW1wdHkoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgTWFya2Rvd25SZW5kZXJlci5yZW5kZXJNYXJrZG93bihcclxuICAgICAgICAgICAgICAgICAgICBjb250ZW50LFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJldmlld0NvbnRhaW5lcixcclxuICAgICAgICAgICAgICAgICAgICBmaWxlLnBhdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpc1xyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1x1OTg4NFx1ODlDOFx1NTJBMFx1OEY3RFx1NTkzMVx1OEQyNTonLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnByZXZpZXdDb250YWluZXIuc2V0VGV4dCgnXHU5ODg0XHU4OUM4XHU1MkEwXHU4RjdEXHU1OTMxXHU4RDI1Jyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNhcmQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBcdTUyMDdcdTYzNjJcdTg5QzZcdTU2RkVcdTZBMjFcdTVGMEZcclxuICAgICAqIEBwYXJhbSB2aWV3IC0gXHU3NkVFXHU2ODA3XHU4OUM2XHU1NkZFXHU2QTIxXHU1RjBGXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgc3dpdGNoVmlldyh2aWV3OiAnY2FyZCcgfCAnbGlzdCcgfCAndGltZWxpbmUnKSB7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50VmlldyA9IHZpZXc7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuc2V0QXR0cmlidXRlKCdkYXRhLXZpZXcnLCB2aWV3KTtcclxuICAgICAgICB0aGlzLmxvYWROb3RlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogXHU2ODM5XHU2MzZFXHU2ODA3XHU3QjdFXHU4RkM3XHU2RUU0XHU3QjE0XHU4QkIwXHJcbiAgICAgKiBAcGFyYW0gdGFnIC0gXHU2ODA3XHU3QjdFXHU1NDBEXHU3OUYwXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZmlsdGVyQnlUYWcodGFnOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBmaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldE1hcmtkb3duRmlsZXMoKTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5lbXB0eSgpO1xyXG5cclxuICAgICAgICBmaWxlcy5mb3JFYWNoKGZpbGUgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjYWNoZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKGZpbGUpO1xyXG4gICAgICAgICAgICBpZiAoY2FjaGU/LnRhZ3MgJiYgY2FjaGUudGFncy5zb21lKHQgPT4gdC50YWcgPT09IHRhZykpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNhcmQgPSB0aGlzLmNyZWF0ZU5vdGVDYXJkKGZpbGUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQoY2FyZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gXHU5QUQ4XHU0RUFFXHU5MDA5XHU0RTJEXHU3Njg0XHU2ODA3XHU3QjdFXHJcbiAgICAgICAgdGhpcy50YWdDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnYnV0dG9uJykuZm9yRWFjaChidG4gPT4ge1xyXG4gICAgICAgICAgICBpZiAoYnRuLnRleHRDb250ZW50ID09PSB0YWcpIHtcclxuICAgICAgICAgICAgICAgIGJ0bi5hZGRDbGFzcygnYWN0aXZlLXRhZycpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYnRuLnJlbW92ZUNsYXNzKCdhY3RpdmUtdGFnJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSAiXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQSx1QkFBNkU7OztBQ0E3RSxzQkFBaUU7QUFHMUQsSUFBTSxpQkFBaUI7QUFFdkIsNkJBQXVCLHlCQUFTO0FBQUEsRUFhbkMsWUFBWSxNQUFxQixRQUF3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
